<%doc>

Given a table (an optionally an id), build a form with corresponding
fields.  Can be called from within other components for editing/adding
objects to the database.

Arguments:  
  table         -  name of table (REQUIRED)
  id            -  id (row) from the above table  (OPTIONAL)
  session       -  ref to a hash with values to insert (if object ! exist)

</%doc>

<%args>
$table
$id           => undef
%session      => undef
$allow_create => 1
</%args>

<%init>

my $maxselect = 100;
my $DEBUG     = 0;

unless ( $table  ) {
    $m->comp("error.mhtml", error => "Missing required arguments");
}
my $obj;
if ( $id ){
    unless ( $obj = $table->retrieve($id) ){
	$m->comp("error.mhtml", error => "Could not retrieve $table id $id");	
    }
}
my %order   = $ui->meta->get_column_order( $table );
my %linksto = $ui->meta->get_link_sto( $table );

</%init>

<script language="javascript" src="select.js"></script>

<%perl>

my (@headers, @data) = ();
print "<input type=\"hidden\" name=\"table\" value=\"$table\">";
if( $id ) {
    print "<input type=\"hidden\" name=\"id\" value=\"$id\">";
}
foreach my $c ( sort { $order{$a} <=> $order{$b} } keys %order ) {
    next if( $c eq 'id' );

	my %field;
	if( defined( $id ) ) {
		%field = $ui->form_field(object=>$obj, column=>$c, edit=>1, shortFieldName=>1);
	} elsif( exists( $session{$c} ) ) {
		my @defaults = ($linksto{$c}->retrieve($session{$c}));
		%field = $ui->form_field(table=>$table, column=>$c, defaults=>\@defaults, default=>$session{$c}, edit=>1, shortFieldName=>1);
	} else {
		%field = $ui->form_field(table=>$table, column=>$c, edit=>1, shortFieldName=>1);
	}
    push(@headers, $field{'label'});
    push(@data,    $field{'value'});
} # foreach

</%perl>
    <& attribute_table.mhtml, field_headers=>\@headers, data=>\@data, 
                              width=>"2", headercolwidth=>"15%", datacolwidth=>"35%" &>

