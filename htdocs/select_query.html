<%perl>
print "<pre> ", Dumper(%ARGS), "</pre><br>" if $debug;

if ($crit =~ /\w+/){
  if ($crit =~ /\w+\s+\w+/){  #If there's more than one word
     @terms = split /\s+/, $crit;
  }else{
     $crit =~ s/\s+//;
     push @terms, $crit;    
  }
  print "terms are: ",  join ', ', @terms, "<br>" if $debug;
}
</%perl>

<body bgcolor="#FFFFFF" onLoad="opener.getlist(<% "\'" . $field . "\'" %>, <% "\'" . $form_name . "\'" %>)">

%$r = $ui->selectQuery(table => $table, terms => \@terms, max => $max);

<form>
%if (my $n = scalar (keys %$r) ){
%    my $count = 0;
     <input type="hidden" name="0" value="">
%    if ($n >= $max){
       <input type="hidden" name="" value="More than <% $max %> matches.  Refine search">
%    }
%    my @objs = map { $r->{$_} } keys %$r;
%    my $lblfield = ( $ui->getlabels($table) )[0];
%    @objs = sort { $a->$lblfield cmp $b->$lblfield } @objs;
%    foreach my $o (@objs){
%       my $lbl = $ui->getobjlabel($o, ", ");
        <input type="hidden" name="<% $o->id %>" value="<% $lbl %>">
%       last if ($count++) == $max;
%    }
%}else{
       <input type="hidden" name="0" value="No matches">
%}
</form>
</body>

<%init>
my ( $r, $max, @terms, $debug );
my $ui = Netdot::UI->new();
$max = 100;
$debug = 0;
</%init>

<%args>
$table     => $ARGS{table};
$field     => $ARGS{field};
$crit      => $ARGS{crit};
$form_name => $ARGS{form_name};
</%args>

<%doc>

Calls UI::selectQuery to perform a recursive search for keywords
in a table's label fields
Creates a dummy form with results, which are then copied by select.js
into the working webpage.

Arguments:
- table:  Foreign key table to search.
- field:  Name of the original field for which we're searching foreign values
          Needed by the caller
- crit:   Criteria.  A string with one or more keywords to search

- form_name: optional form name for original caller. If not specified assumes
             form name is "netdotform".

</%doc>
