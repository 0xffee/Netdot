<%doc>

Add an IP service object from device worksheet

</%doc>
%
%
<%flags>
inherit => undef 
</%flags>
%
%
%
<%args>
$ip     =>   undef
$Add    =>   undef
$Cancel =>   undef
</%args>
%
%
<%init>
my %state;
my $ipobj;
my $iplbl;
if ( $ip ){
    $ipobj = Ipblock->retrieve($ip);
    $iplbl = $ui->getobjlabel($ipobj, "/");
}
my %reserved = ( Add    => "",
		 Cancel => "",
		);

my $newsrvid;

</%init>

% my $bodyargs;
% if ( $Add ){
%     $bodyargs = 'onUnload="opener.location.reload()"';
% } else {
%     $bodyargs = '';
% }

<html>
<head>
    <link rel="stylesheet" href="style.css" type="text/css">
</head>      
<body class="bodytag" <% $bodyargs %>>

<div class="container">
    <div class="containerhead">
        Add IP Service
    </div>
    <div class="containerbody">

<%perl>
if ( $Add ){
    foreach my $arg ( keys %ARGS ){
    	next if ( exists $reserved{$arg} );
    	$state{$arg} = $ARGS{$arg};
    }
    unless ( $newsrvid = $ui->insert(table => "IpService", state => \%state) ){
    	$m->comp("error.mhtml", error => $ui->error, showplainerror=>1);
    }  
</%perl>
    <br>
    <a href="#" onClick="window.close()">[done]</a>

%}elsif ( $Cancel ){
    <br>
    Cancelled.
    <br>
    <a href="#" onClick="window.close()">[done]</a><br>
    
%}else{

<form action="addservice.html" method="POST">
<input type="hidden" name="ip" value="<% $ip %>">

<%perl>
    my (@field_headers, @cell_data) = ();
    
    push( @field_headers, "IP: " );
    push( @cell_data, $iplbl );

    push( @field_headers, "Service: " );
    push( @cell_data, 
&{sub{
    my $ac = '<select name="service">';
    foreach my $o ( sort { $a->name cmp $b->name } Service->retrieve_all() ){
	    $ac .= '<option value="'.$o->id.'">'.$o->name.'</option>';
    }
    $ac .= '</select>';
    $ac;
    }}  );

    push( @field_headers, "Monitored: " );
    push( @cell_data, '<input type="checkbox" name="monitored" CHECKED>' );

    push( @field_headers, "Contact Group: " );
    push( @cell_data, 
&{sub{
    my $ac = '<select name="contactlist">';
    foreach my $o ( sort { $a->name cmp $b->name } ContactList->retrieve_all() ){
	    $ac .= '<option value="'.$o->id.'">'.$o->name.'</option>';
    }
    $ac .= '</select>';
    $ac;
    }}  );
</%perl>

<& attribute_table.mhtml, field_headers=>\@field_headers, data=>\@cell_data &>

    <input name="Add" value="Add" type="submit">
    <input name="Cancel" value="Cancel" type="submit">

</form>

% } #else

    </div> <!-- close containerbody -->
</div> <!-- close container -->
 
</body>
</html>
