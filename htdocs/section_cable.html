<%doc>
    Cable Plant Section
</%doc>
%
%
<%args>
$user
</%args>
%
%
<%attr>
title   => 'Cable Plant' 
section => 'Plant'
</%attr>
%
%
<%init>
my %caller_args = $m->caller_args(-1);

if (exists($caller_args{page})) {
    $user->setAttribute($r, "CABLE_PLANT_PAGE", $caller_args{page});
}

my $page = $user->getAttribute("CABLE_PLANT_PAGE");
</%init>


<div id="sectiontools">

<script language="JavaScript" src="select.js"></script>

<script language="JavaScript">
<!--
/* hideOptions()
 *
 * hide backbone/horizontal cable sections.
*/
function hideOptions(name)
{
    var opt = document.getElementById(name);
    opt.style.display = (opt.style.display == "none" ? "" : "none");
}
-->
</script>
%
<%perl>
my @sites = Site->retrieve_all();
@sites = sort { $a->name cmp $b->name } @sites;
</%perl>
%
<p>


% if ($page eq "BACKBONE" || $page eq "") {

<div class="containeroutside">

    
<script language="JavaScript">
<!--
var siteListLookup = new DynamicList("backbone_form", "end_id", null, null, "start_id");
siteListLookup.setQueryURL("backbone_list_query.html");
LIST_MANAGER.addList(siteListLookup);
-->
</script>

    <div class="containerheadleftoutside">
        <b>Backbone Cable</b> 
    </div>
    <div class="containerheadrightoutside">
        <a href="#" onClick="hideOptions('backbone_options');">[hide/show]</a>
        &nbsp; <a href="cable_backbone.html?id=NEW">[new]</a>
    </div>
    <div class="containerbodyoutside">


    <table border="0" cellpadding="4" cellspacing="0" width="100%" class="formtablebg">
    <tr align="left" valign="top">
    <td>
    <form name="backbone_form" action="cable_plant.html" method="POST">
        <input type="hidden" name="page_type" value="BACKBONE">
        Connected from:<br>
        <select name="start_id" onChange="siteListLookup.doIt();">
        <option value="">-- Make your selection --</option>
        <%perl>
        foreach my $site (@sites)
        {
            printf("<option value=\"%s\">%s</option>\n", $site->id, $site->name);
        }
        </%perl>
        </select> <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>- TO -</B><br>
   
        <select name="end_id">
        </select><br>
        <input name="submit_site" value="Go!" type="submit"> &nbsp;&nbsp;&nbsp;
    </form>
    </td>
    
    <td align="left">
    <form name="backbone_srch" action="cable_plant.html" method="POST">
        <input type="hidden" name="page_type" value="BACKBONE">  
        Backbone Name: <input name="backbone_srch" size="20"> &nbsp;<input type="submit" name="submit_backbone_search" value="Search">
    </form>
    
    <br>
    
    <form name="site_srch" action="cable_plant.html" method="POST">
        <input type="hidden" name="page_type" value="BACKBONE">  
        Site Name: <input name="site_srch" size="20"> &nbsp;<input type="submit" name="submit_site_search" value="Search">
   
    </td>
    </tr>
    </table>
    </form>
</div>
</div>

% } elsif ($page eq "HORIZONTAL") {

<div class="containeroutside">

<script language="JavaScript">
<!--
var jackList = new DynamicList("cable_form", "jack_id", "closet", "HorizontalCable", "closet_id");
var closetList = new DynamicList("cable_form", "closet_id", "floor", "Closet", "floor_id", jackList);
var roomList = new DynamicList("cable_form", "room_id", "floor", "Room", "floor_id");
var floorList = new DynamicList("cable_form", "floor_id", "site", "Floor", "id", roomList, closetList);

LIST_MANAGER.addList(jackList, closetList, roomList, floorList);
-->
</script>


	<div class="containerheadleftoutside">
        <b>Horizontal Cable</b> 
    </div>
    <div class="containerheadrightoutside">
        <a href="#" onClick="hideOptions('horizontal_options');">[hide/show]</a>
        &nbsp; <a href="cable_horizontal.html?id=NEW">[new]</a>
    </div>
	<div class="containerbodyoutside">
	<form name="cable_form" action="cable_plant.html" method="GET">
  	<input type="hidden" name="page_type" value="HORIZONTAL">
    <table border="0" cellpadding="4" cellspacing="0" width="100%" class="formtablebg">
        <tr align="left" valign="top">
            <td width="280" align="left">Site:<BR>
            <select name="id" onChange="floorList.doIt();">
            <option value="">-- Make your selection --</option>
            <%perl>
            foreach my $site (@sites) {
                printf("<option value=\"%s\">%s</option>\n", $site->id, $site->name);
            }
            </%perl>
            </select> &nbsp;<input name="submit_site" value="Browse by Site" type="submit">
            </td>

            <td width="100" align="left">Floor:<br>
%           # When selecting by floor, default to populating our jack list based upon the closet lists contents            
            <select name="floor_id" onChange="roomList.doIt(); jackList.setParent('closet_id'); jackList.setDBField('closet'); closetList.doIt();">
            </select>
            </td>

            <td width="160" align="left">
%           # Because both the room list and the closet list can affect the jack list, we explicitly tell the jacklist to look
%           # at this list.
            Room: <select name="room_id" onChange="jackList.setParent('room_id'); jackList.setDBField('room'); jackList.doIt(); document.cable_form.closet_id.options[0].selected = true;">
            </select><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>- or -</i><br>
%           # Like above, make sure the jacklist uses our closet selection instead of the room selection.            
            Closet: <select name="closet_id" onChange="jackList.setParent('closet_id'); jackList.setDBField('closet'); jackList.doIt(); document.cable_form.room_id.options[0].selected = true;"></select>
            </td>

            <td width="180" align="left">Jack:<br>
            <select name="jack_id">
            </select> &nbsp;<input type="button" name="go" value="Go!" onClick="if (jack_id.value && jack_id.value != -1) { location.href = ('cable_horizontal.html?id=' + jack_id.value); } else if (document.cable_form.id.value) { location.href = ('cable_plant.html?id=' + document.cable_form.id.value + '&page_type=HORIZONTAL'); } return true;">
            </td>
            <td>&nbsp;</td>
        </tr>

        <tr align="left" valign="top"><td colspan="5"><hr></td></tr>

        <tr align="left" valign="top">
            <td align="left" colspan="5">
%           my $srchf = 'jack_srch';  # name of the form input tag
	        <input type="text" name="<% $srchf %>" value="By Jack ID(s)" onFocus="if (this.value == 'By Jack ID(s)') { this.value = ''; } return true;">
	        &nbsp;<input type="button" name="" value="Lookup Jack" 
            onClick="sendquery(<% 'jack_lookup' %>, <% $srchf . '.value' %>, 'HorizontalCable', 'cable_form')"> &nbsp;&nbsp;&nbsp; 
            Lookup Results: <select name="jack_lookup">
            </select> &nbsp;<input type="button" name="go_lookup" value="Go!" onClick="if (jack_lookup.value) { location.href = ('cable_horizontal.html?id=' + jack_lookup.value); return true; }"> &nbsp;&nbsp;
            </td>
        </tr>
    </table>
    </form>
</div>
</div>

% } elsif ($page eq "CLOSETS") {

<script language="JavaScript">
<!--
var closetList = new DynamicList("cable_form", "closet_id", "floor", "Closet", "floor_id");
var floorList = new DynamicList("cable_form", "floor_id", "site", "Floor", "id", closetList);

LIST_MANAGER.addList(floorList, closetList);
-->
</script>
<div class="containeroutside">
	<div class="containerheadleftoutside">
        <b>Closets</b> 
    </div>
    <div class="containerheadrightoutside">
        <a href="#" onClick="hideOptions('closet_options');">[hide/show]</a> &nbsp;&nbsp;&nbsp;
        <a href="closet.html?id=NEW">[new]</a>
    </div>
<div class="containerbodyoutside">
    <form name="cable_form" action="cable_plant.html" method="GET">
    <input type="hidden" name="page_type" value="CLOSETS">
    <table border="0" cellpadding="4" cellspacing="0" width="100%" class="formtablebg">
        
        <tr align="left" valign="top">
            <td width="280" align="left">Site:<BR>
            <select name="id" onChange="floorList.doIt();">
            <option value="">-- Make your selection --</option>
            <%perl>
            foreach my $site (@sites) {
                printf("<option value=\"%s\">%s</option>\n", $site->id, $site->name);
            }
            </%perl>
            </select> &nbsp;<input name="submit_site" value="Browse by Site" type="submit">
            </td>

            <td width="100" align="left">Floor:<br>
            <select name="floor_id" onChange="closetList.doIt();">
            </select>
            </td>
            
            <td width="100" align="left">Closet:<br>
            <select name="closet_id">
            </select> &nbsp;<input type="button" name="go" value="Go!" onClick="if (closet_id.value && closet_id.value != -1) { location.href = ('closet.html?id=' + closet_id.value); } else if (document.cable_form.id.value) { location.href = ('cable_plant.html?id=' + document.cable_form.id.value + '&page_type=CLOSETS'); } return true;">
            </td>
            <td>&nbsp;</td>
        </tr>
    </table>
    </form>

    <hr>

    <form name="closet_form" action="cable_plant.html" method="POST">
    <input type="hidden" name="page_type" value="CLOSETS">
    <table border="0" cellpadding="4" cellspacing="0" width="100%" class="formtablebg">
        <tr align="left" valign="top">
        <td>Closet Name: <input name="closet_srch" size="25"> &nbsp;<input type="submit" name="submit_closet_search" value="Search"></td>
        </tr>
    </table>
    </form>
</div>
</div>

% } elsif ($page eq "STRANDS") {
<div class="containeroutside">
	<div class="containerheadleftoutside">
        <b>Cable Strands</b>
    </div>
    <div class="containerheadrightoutside">
        <a href="#" onClick="hideOptions('strand_options');">[hide/show]</a> &nbsp;&nbsp;&nbsp;
        <a href="cable_strand.html?id=NEW">[new]</a>
    </div>
	<div class="containerbodyoutside">
    <form name="cable_form" action="cable_plant.html" method="GET">
    <input type="hidden" name="page_type" value="STRANDS">
    <table border="0" cellpadding="4" cellspacing="0" width="100%" class="formtablebg">
        <tr align="left" valign="top">
            <td align="left">
%           my $backbone_srch = 'backbone_srch';  # name of the form input tag
	        <input type="text" name="<% $backbone_srch %>" value="By Backbone" onFocus="if (this.value == 'By Backbone') { this.value = ''; } return true;">
	        &nbsp;<input type="button" name="" value="Lookup Backbone" 
            onClick="sendquery(<% 'backbone_id_srch' %>, <% $backbone_srch . '.value' %>, 'BackboneCable', 'cable_form')"> &nbsp;&nbsp;&nbsp; 
            Lookup Results: <select name="backbone_id_srch">
            </select><input type="submit" name="backbone_submit" value="Browse by Backbone">
            </td>
        </tr>

        <tr align="left" valign="top"><td colspan="5"><hr></td></tr>

        <tr align="left" valign="top">
            <td align="left">
%           my $srchf = 'strand_srch';  # name of the form input tag
	        <input type="text" name="<% $srchf %>" value="By Strand Name" onFocus="if (this.value == 'By Strand Name') { this.value = ''; } return true;">
	        &nbsp;<input type="button" name="" value="Lookup Strand" 
            onClick="sendquery(<% 'strand_lookup' %>, <% $srchf . '.value' %>, 'CableStrand', 'cable_form')"> &nbsp;&nbsp;&nbsp; 
            Lookup Results: <select name="strand_lookup">
            </select> &nbsp;<input type="button" name="go_lookup" value="Go!" onClick="if (strand_lookup.value && strand_lookup.value != 0) { location.href = ('cable_strand.html?id=' + strand_lookup.value); return true; }"> &nbsp;&nbsp;
            </td>
        </tr>
    </table>
    </form>
</div>
</div>

% } elsif ($page eq "CIRCUITS") {
<div class="containeroutside">
	<div class="containerheadleftoutside">
        <b>Circuits</b> 
	</div>
	<div class="containerheadrightoutside">
        <a href="#" onClick="hideOptions('circuit_options');">[hide/show]</a> &nbsp;&nbsp;&nbsp;
        <a href="circuit.html?id=NEW">[new]</a>
	</div>
	<div class="containerbodyoutside">
    <form name="circuit_lookup_form" action="cable_plant.html" method="POST">
        <input type="hidden" name="page_type" value="CIRCUITS">
        Circuits connected from:<br>
        <select name="start_id">
        <option value="">-- Make your selection --</option>
        <%perl>
        foreach my $site (@sites) {
            printf("<option value=\"%s\">%s</option>\n", $site->id, $site->name);
        }
        </%perl>
        </select> <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>- TO -</B><br>
   
        <select name="end_id">
        <option value="">-- Make your selection --</option>
        <%perl>
        foreach my $site (@sites) {
            printf("<option value=\"%s\">%s</option>\n", $site->id, $site->name);
        }
        </%perl>
        </select><br>
        <input name="submit_site" value="Go!" type="submit"> &nbsp;&nbsp;&nbsp;
    </form>
    </td>
    <td>
    <form name="circuit_srch_form" action="cable_plant.html" method="POST">
        <input type="hidden" name="page_type" value="CIRCUITS">  
        Circuit: <input name="circuit_srch" size="30"> &nbsp;<input type="submit" name="submit_circuit_search" value="Search">
    </form>
    </td>
    </tr>
    </table>
</div> <!-- close containerbodyoutside -->
</div> <!-- close containeroutside -->

% }

</div> <!-- close sectiontools -->


% #############################################################################
%
% if ( $m->fetch_next ){
%  $m->call_next;
% }
