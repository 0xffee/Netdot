<& header, title =>'General Search' &>

<form action="generic-search.html" method="POST">

<%perl>
my %arg;
foreach my $j ( keys %ARGS ) {
  next if( $ARGS{$j} !~ /\w+/ || $j eq "submit" );
  if( $j eq "q" ) {
    $ARGS{$j} = "%" . $ARGS{$j} . "%" ; # munge for search_like
  }
  $arg{$j} = $ARGS{$j};
}
</%perl>

<p><font size=+1>Netdot Search</font>

<form>
<table cellpadding="3" cellspacing="1" border="0" bgcolor="CCCCCC">
  <tr>
  <td><input type="text" name="q" size="25"></td>
  <td><input name="submit" value="Submit" type="submit"></td>
  </tr>
</table>
</form>

% if( %arg ) {
    <table width="100%">
    <tr><td width="100%" height="5" bgcolor="#000099"> </td></tr>
    </table>
    <%perl>
    undef %results;  # may be cached copy in memory
    foreach my $tbl ( $dbh->tables() ) {
      foreach my $col ( $tbl->columns() ) {
        map { $results{$tbl}{$_->id} = $_ } 
          $tbl->search_like( $col => $arg{q} );
      }
    }
    </%perl>
    <table cellpadding="0" border="0" align="center" width="100%" bgcolor="#CCCCCC">
    <tr>
%   if( ! %results ) {
      <td>No matching records were found.</td>
%   } else {
%     foreach my $tbl ( keys %results ) {
%       next if( $tbl eq "Meta" );
%       my @objs;
%       map { push @objs, $results{$tbl}{$_} } keys %{ $results{$tbl} };
	<tr>
        <td><strong><% $tbl %></strong>
        <& sortresults.html, table => $tbl, object => \@objs, view => "expanded" &>

%     } # end foreach tbl
%   } # end else
    </tr>
    </table>
% }

<& footer &>

<%init>
use lib "/home/netdot/public_html/lib";
use Netdot::DBI;
use Data::Dumper;
use DBI;

use vars qw( %results );

my $dbh = DBI->connect( "dbi:mysql:netdot", "netdot_user", "netdot_pass" )
	  or die "Can't connect to db: $DBI::errstr\n";


              
</%init>

<%doc>

######################################################################
# $Log: search.html,v $
# Revision 1.5  2003/05/01 00:12:40  netdot
# supporting view argument in sortresults.html
#
# Revision 1.4  2003/04/30 23:55:42  netdot
# reflecting design in expview by carlos.  putting the name of the table
# on the page to distinguish among tables.
#
# Revision 1.3  2003/04/23 17:42:18  netdot
# now using sortresults.html module for processing presentation
#
# Revision 1.2  2003/04/23 17:16:52  netdot
# nothing for now; just putting this in rcs
#
# Revision 1.1  2003/04/23 17:13:08  netdot
# Initial revision
#
</%doc>
