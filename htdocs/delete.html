<& index.html, title => " Delete: $table object" , s2name => $s2name  &>

<table align="center" valign="top" border="0" width="95%" class="formtablebg">
<tr><td>

%if ( $submit eq "Delete"  ){
<p>Are you sure you want to delete the following objects?
     <table>
<%perl>
    unless($session = $ui->mksession( $TMP )){
	$m->comp('error.mhtml', error => $ui->error);
    }
    # Accept single-delete queries with only table and id
    if ( $table && $id ){
	my $key = $table . "__" . $id;
	$ARGS{$key} = "1";
    }
    foreach my $arg (sort keys %ARGS){
	next unless $arg =~ /__/;
	my ($table, $id) = split /__/, $arg;
	my $obj;
	eval {
	    $obj = $table->retrieve($id) 
	    };
	if ($@){
	    $m->comp('error.mhtml', error => "Error retrieving $table id $id: $@");
	}
	my $lbl = $ui->getobjlabel($obj, ", ");
</%perl>
       <tr>
	   <td>&nbsp;</td>
	   <td><% $table %> <% $lbl %></td>
       </tr>
       
%      push @objs, [$table, $obj, $lbl];
%   }
%   $session->{objects} = \@objs;

    </table>
    <form method="POST" action="delete.html">
    <input type="hidden" name="s2name" value="Management">
    <input type="hidden" name="sid" value="<% $session->{_session_id} %>">
    <input name="submit" value="Confirm" type="submit">
    <input name="submit" value="Cancel" type="submit">
    </form>
<%perl>

}elsif ($submit eq "Confirm"){
    unless($session = $ui->getsession( $TMP, $sid )){
	$m->comp('error.mhtml', error => $ui->error);
    }
    @objs = @{ $session->{objects} };
    foreach my $r (@objs){
	my ($table, $obj, $lbl) = @$r;
	# Delete the object
	eval {
	    $obj->delete;
	};
	if ($@){
	    $m->comp('error.mhtml', error => "$@");
	} else{
</%perl>
           <strong><% $table %> <% $lbl %></strong> deleted.<br>
%       }
%    }
%}elsif ($submit eq "Cancel"){
<p><br>
    Deletion cancelled
%   $ui->rmsession( $session );
%}

</td></tr>
</table>
<& footer.mhtml &>

<%args>
$table   => undef
$id      => undef
$s2name  => "Management"
$submit  => "Delete"
$sid     => undef
</%args>

<%init>
my $ui = Netdot::UI->new();
my $session;
my @objs;
my $TMP;
my $DEBUG = 0;
my @objects;

print Dumper(%ARGS) if $DEBUG;

</%init>

<%doc>
    Delete one or more objects
</%doc>
