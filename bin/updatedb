#
# Make the necessary modifications to upgrade Netdot's schema and data
#
use strict;
use vars qw( $dbh $DEBUG $DB_TYPE $DB_HOST $DB_PORT 
	     $DB_DBA $DB_DATABASE $DB_DBA_PASSWORD);

use DBUTIL;

($DB_TYPE, $DB_HOST, $DB_PORT, $DB_DBA, $DB_DBA_PASSWORD, $DB_DATABASE) = @ARGV;



if ( my $dbh = &dbconnect($DB_TYPE, $DB_HOST, $DB_PORT, $DB_DBA, $DB_DBA_PASSWORD, $DB_DATABASE) ){
    
    # Convert Mysql tables from MyISAM to INNODB
    my @lines;
    foreach my $table ( $dbh->tables ){
	push @lines, "ALTER TABLE $table ENGINE=INNODB";
    }
    
    # Drop the obsolete Meta table
    push @lines, "DROP TABLE Meta";

	# column nsdname should be an integer, not a varchar
	push @lines, "ALTER TABLE RRNS CHANGE nsdname nsdname int(11) default NULL";
    
    &processdata($dbh, \@lines);
    
    &dbdisconnect($dbh);
}


