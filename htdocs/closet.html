<%doc>
Closet interface 

</%doc>

<%args>
$id         => undef;
$edit       => undef;
$bb_sort    => undef;
$cable_sort => undef;
$pic_sort   => undef;
$s2name     => "Plant";
</%args>

<%init>
my $DEBUG          = 0;
my %cssitem        = (0 => "formtablec1", 1 => "formtablec2");
my $o              = undef;
my $site           = undef;
my $editCloset     = 0;
my $editPictures   = 0;
my $editBackbones  = 0;
my $editHorizontal = 0;

if ($id && $id ne "NEW")  {
   $o = Closet->retrieve($id);
   $site = $o->floor->site || $o->site;
}

$editCloset = 1 if ($id eq "NEW" || $edit eq "closetinfo");
$editPictures = 1 if ($edit eq "closetpictures");
$editBackbones = 1 if ($edit eq "bbinfo");
$editHorizontal = 1 if ($edit eq "cableinfo");
</%init>

<& index.html, title => "Cable Plant: Closet", s2name => $s2name  &>

<%perl>
print "<pre>", Dumper(%ARGS), "</pre><br>" if $DEBUG;

# code for inserting/updating
# -----------------------------------------------------------------------------
if (defined($ARGS{_action})) {
    my %update_info = ();
    print "ARGS is  <pre>", Dumper(%ARGS), "</pre><br>" if $DEBUG;
    if (!(%update_info = $ui->form_to_db(%ARGS))) {
        $m->comp("error.mhtml", $ui->error());
	}

    if ($update_info{Closet}{key}) {
        $id = $update_info{Closet}{key};
        $editCloset = 0;
    }

    # Do this to 'flush' the values associated with the object
    # before redisplaying
    $o = undef;
    $site = undef;
    if ($id && $id ne "NEW") {
        $o = Closet->retrieve($id);
        $site = $o->floor->site || $o->site;
    }
}

if (defined($ARGS{_action}) && $ARGS{_action} eq "ADD_PICTURE" && defined($ARGS{__picture}) && $ARGS{__picture} ne "") {
    my $ret = $ui->insertbinfile($ARGS{__picture});
    $m->comp("error.mhtml", $ui->error()) if (!$ret);
    $m->comp("error.mhtml", $ui->error()) if (!($ui->insert(table=>"ClosetPicture", state=>{closet=>$id, binfile=>$ret})));
} elsif (defined($ARGS{_action}) && $ARGS{_action} eq "UPDATE_PICTURES") {
    my %deleted = ();
    foreach my $key (keys(%ARGS)) {
        if ($key =~ /^__delete_pic_(\d+)/o) {
            # if deleting a picture
            my $obj = ClosetPicture->retrieve($1);
            my $binfileid = $obj->binfile->id;
            my $objid = $obj->id;
            $m->comp("error.mhtml", $ui->error()) if (!($ui->remove(table=>"ClosetPicture", id=>$objid)));
            $m->comp("error.mhtml", $ui->error()) if (!($ui->remove(table=>"BinFile", id=>$binfileid)));
            $deleted{$1} = 1;
        } elsif ($key =~ /^__picture_(\d+)/o && !exists($deleted{$1})) {
            # if uploading a new picture in place of another.
            next if ($ARGS{$key} eq "");
            $m->comp("error.mhtml", $ui->error()) if (!($ui->updatebinfile($ARGS{$key}, $1)));
        }
    }
}
# end insertion/update code
# -----------------------------------------------------------------------------
</%perl>

<script language="JavaScript">
<!--
var floorSearchList = new DynamicList("closetform", "Closet__<% $id %>__floor", "site", "Floor", "floor_srch");
LIST_MANAGER.addList(floorSearchList);
-->
</script>

% if ($site) {
<!-- Header Table -->
<table border="0" width="95%" align="center" cellpadding="3" cellspacing="0" class="tablebackground">
 <tr class="rowtitle0">
    <td align="left">
        Closet for Site: <a href="cable_plant.html?id=<% $site->id %>&page_type=CLOSETS"><% $site->name %></a>&nbsp;&nbsp;&nbsp;
    </td>
 </tr>
</table>
% }

<!-- Closet Table -->
<table border="0" width="95%" align="center"  class="tablebackground">
    <tr>
    <td valign="top" width="50%" align="center">
        <form name="closetform" action="closet.html" method="POST" enctype="multipart/form-data">
        <input type="hidden" name="id" value="<% $id %>">
        <input type="hidden" name="_action" value="1">
        <input type="hidden" name="s2name" value="<% $s2name %>">
        <table border="0" width="100%"  class="formtablebg" cellpadding="0" cellspacing="2">
        <tr class="formtabletitle">
            <td colspan="2" align="left">Closet</td>
%           if ($editCloset) {
            <td align="right"><input type="button" name="cancel_button" value="cancel" onClick="history.go(-1);"> &nbsp;&nbsp; <input name="submit" value="save" type="submit"></td>
%           } else {
            <td align="right"><a href="closet.html?id=NEW">[new]</a> || <a href="closet.html?id=<% $id %>&edit=closetinfo">[edit]</a> || <a href="delete.html?table=Closet&id=<% $id %>">[delete]</a></td>
%           }
        </tr>
        <tr align="left" valign="top">
            <td width="40%">
            <table width="100%" border="0" cellspacing="2" cellpadding="0">
            <tr align="left" valign="top">
                <td align="left">Name: </td>
                <td align="left" class="formtablec2">
%               $ui->text_field(object=>$o, table=>"Closet", column=>"name", edit=>$editCloset);
                </td>
            </tr>

            <tr align="left" valign="top">
                <td align="left">Number: </td>
                <td align="left" class="formtablec2">
%               $ui->text_field(object=>$o, table=>"Closet", column=>"number", edit=>$editCloset);                
                </td>
            </tr>

            <tr align="left" valign="top">
                <td align="left">Floor: </td>
                <td align="left" class="formtablec2">
%               if ($editCloset) {
%                   $ui->select_lookup(object=>$o, table=>"Closet", column=>"floor", lookup=>"Floor", 
%                                     edit=>$editCloset, where=>{site=>($o ? $o->site : "")});
                     &nbsp;<select name="floor_srch" onChange="floorSearchList.doIt();" style="width: 150px;">
                    <option value="">Lookup by Site</option>
                    <%perl>
                    my @sites = Site->retrieve_all();
                    @sites = sort { $a->name cmp $b->name } @sites;
                    foreach my $s (@sites)
                    {
                        printf("<option value=\"%s\">%s</option>\n", $s->id, $s->name);
                    }
                    </%perl>
                    </select>
%               } else {
                    <a href="floor.html?id=<% $o->floor %>"><% $o->floor->level %></a>
%               }
                </td>
            </tr>

            <tr align="left" valign="top">
                <td align="left">Dimensions: </td>
                <td align="left" class="formtablec2">
%               $ui->text_field(object=>$o, table=>"Closet", column=>"dimensions", edit=>$editCloset);                
                </td>
            </tr>

            <tr align="left" valign="top">
                <td align="left">Racks: </td>
                <td align="left" class="formtablec2">
%               $ui->text_field(object=>$o, table=>"Closet", column=>"racks", edit=>$editCloset);                
                </td>
            </tr>

            <tr align="left" valign="top">
                <td align="left">Outlets: </td>
                <td align="left" class="formtablec2">
%               $ui->text_field(object=>$o, table=>"Closet", column=>"outlets", edit=>$editCloset);                
                </td>
            </tr>

            <tr align="left" valign="top">
                <td align="left">Shared With: </td>
                <td align="left" class="formtablec2">
%               $ui->text_field(object=>$o, table=>"Closet", column=>"shared_with", edit=>$editCloset);                
                </td>
            </tr>

            <tr align="left" valign="top">
                <td align="left">HVAC Type: </td>
                <td align="left" class="formtablec2">
%               $ui->text_field(object=>$o, table=>"Closet", column=>"hvac_type", edit=>$editCloset);                
                </td>
            </tr>

            <tr align="left" valign="top">
                <td align="left">Ground Buss: </td>
                <td align="left" class="formtablec2">
%               $ui->radio_group_boolean(object=>$o, table=>"Closet", column=>"ground_buss", edit=>$editCloset);                
                </td>
            </tr>

            <tr align="left" valign="top">
                <td align="left">Asbestos Tiles: </td>
                <td align="left" class="formtablec2">
%               $ui->radio_group_boolean(object=>$o, table=>"Closet", column=>"asbestos_tiles", edit=>$editCloset);                
                </td>
            </tr>
            </table>
            </td>
            
            <td width="40%">
            <table width="100%" border="0" cellspacing="2" cellpadding="0">
            <tr align="left" valign="top">
                <td align="left">RU Available: </td>
                <td align="left" class="formtablec2">
%               $ui->text_field(object=>$o, table=>"Closet", column=>"ru_avail", edit=>$editCloset);                
                </td>
            </tr>
            
            <tr align="left" valign="top">
                <td align="left">Patch Panels: </td>
                <td align="left" class="formtablec2">
%               $ui->text_field(object=>$o, table=>"Closet", column=>"patch_panels", edit=>$editCloset);                
                </td>
            </tr>

            <tr align="left" valign="top">
                <td align="left">110 Blocks: </td>
                <td align="left" class="formtablec2">
%               $ui->text_field(object=>$o, table=>"Closet", column=>"110_blocks", edit=>$editCloset);                
                </td>
            </tr>

            <tr align="left" valign="top">
                <td align="left">66 Blocks: </td>
                <td align="left" class="formtablec2">
%               $ui->text_field(object=>$o, table=>"Closet", column=>"66_blocks", edit=>$editCloset);                
                </td>
            </tr>

            <tr align="left" valign="top">
                <td align="left">CatV Taps: </td>
                <td align="left" class="formtablec2">
%               $ui->text_field(object=>$o, table=>"Closet", column=>"catv_taps", edit=>$editCloset);                
                </td>
            </tr>

            <tr align="left" valign="top">
                <td align="left">Access Key Type: </td>
                <td align="left" class="formtablec2">
%               $ui->text_field(object=>$o, table=>"Closet", column=>"access_key_type", edit=>$editCloset);                
                </td>
            </tr>

            <tr align="left" valign="top">
                <td align="left">Rack Type: </td>
                <td align="left" class="formtablec2">
%               $ui->text_field(object=>$o, table=>"Closet", column=>"rack_type", edit=>$editCloset);                
                </td>
            </tr>

            <tr align="left" valign="top">
                <td align="left">Pair Count: </td>
                <td align="left" class="formtablec2">
%               $ui->text_field(object=>$o, table=>"Closet", column=>"pair_count", edit=>$editCloset);                
                </td>
            </tr>

            <tr align="left" valign="top">
                <td align="left">Converted Patch Panels: </td>
                <td align="left" class="formtablec2">
%               $ui->text_field(object=>$o, table=>"Closet", column=>"converted_patch_panels", edit=>$editCloset);                
                </td>
            </tr>

            <tr align="left" valign="top">
                <td align="left">Work Needed: </td>
                <td align="left" class="formtablec2">
%               $ui->text_field(object=>$o, table=>"Closet", column=>"work_needed", edit=>$editCloset);                
                </td>
            </tr> 
            </table>
            </td>
            <td>&nbsp;</td>
        </tr>

        <tr><td colspan="3">&nbsp;<br></td></tr>

        <tr align="left" valign="top">
            <td colspan="2">
            <I>Comments:</I> &nbsp;&nbsp;&nbsp;
%           $ui->text_area(object=>$o, table=>"Closet", column=>"info",
%                         edit=>$editCloset, htmlExtra=>"rows='3' cols='80'");
            </td>
            <td>&nbsp;</td>
        </tr>

        <tr><td colspan="3">&nbsp;<br></td></tr>
        </table>
        </form>
    </td>
    </tr>
</table>
<!-- End Closet Table -->

<!-- Begin Closet Pictures -->
% if (defined($o)) {
<A NAME="pics"></A>
<table border="0" width="95%" align="center"  class="tablebackground">
    <tr>
    <td valign="top" width="50%" align="center">
    <table border="0" width="100%"  class="formtablebg" cellpadding="0" cellspacing="2">
    <tr class="formtabletitle">
     <td colspan="2">
     <form name="cable_strand_form" action="closet.html" method="POST" enctype="multipart/form-data">
     <input type="hidden" name="id" value="<% $id %>">
     <input type="hidden" name="_action" value="UPDATE_PICTURES">
     <input type="hidden" name="s2name" value="<% $s2name %>">
      <table width="100%" border="0">
       <tr>
         <th width="80%" align="center">Closet Pictures</th>
%	 if ($editPictures) {	 
            <td align="right"><input type="button" name="cancel_button" value="cancel" onClick="history.go(-1);"> &nbsp;&nbsp; <input name="submit" value="save" type="submit"></td>
%	 } else {
            <td align="right">
                <a href="closet.html?id=<% $id %>&edit=closetpictures#pics">[edit]</a>
            </td>
%	 }
       </tr>
      </table>
     <td>
   </tr>
   <tr>
     <td>
      
    <table border="0" width="90%">
    <%perl>
    my @pictures;
    map { push (@pictures, $_) } $o->pictures;
    </%perl>

%	if (scalar(@pictures)) {
    <tr>
        <td align="left">
            <a href="closet.html?id=<% $id %>&pic_sort=filename#pics">File Name</a>
        </td>
        <td align="left">
            <a href="closet.html?id=<% $id %>&pic_sort=filesize#pics">Size</a>
        </td>
        <td align="left">
            <a href="closet.html?id=<% $id %>&o_sort=filetype#pics">File Type</a>
        </td>
        <td align="left">
            <a href="closet.html?id=<% $id %>&strand_sort=info#pics">Comments</a>
        </td>
    </tr>

    <%perl>
    my @sorted_pics;
    $pic_sort = "filename" if (!$pic_sort);
    @sorted_pics = sort { $a->binfile->$pic_sort cmp $b->binfile->$pic_sort } @pictures;
    </%perl>

%   my $i = 0;
%   foreach my $pic (@sorted_pics) {
%   $i = ($i + 1) % 2;
    <tr align="left" class="<% $cssitem{$i} %>">
        <td align="left">
%       if ($editPictures) {
            <input type="checkbox" name="<% "__delete_pic_". $pic->id %>">[del]
%           $ui->text_field(object=>$pic->binfile, table=>"BinFile", column=>"filename", edit=>$editPictures);
            <br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Update Picture: &nbsp;<input type="file" name="__picture_<% $pic->id %>" size="20" value="">
%       } else {
            <a href="display_bin.html?id=<% $pic->binfile->id %>" TARGET=_new><% $pic->binfile->filename %></a>
%       }
        </td>

        <td align="left">
            <% $pic->binfile ? $pic->binfile->filesize : "" %>
        </td>

        <td align="left">
%           $ui->text_field(object=>$pic->binfile, table=>"BinFile", column=>"filetype", edit=>$editPictures); 
        </td>

        <td align="left">
%           $ui->text_area(object=>$pic->binfile, table=>"BinFile", column=>"info",
%                         edit=>$editPictures, htmlExtra=>"rows='2' cols='40'");

        </td>
    </tr>
%   }
%}
    </table>
    </td>
    </tr>
    </table>
    </form>

    <br>

%	 if (!$editPictures) {
    <form action="closet.html" method="POST" enctype="multipart/form-data">
    <input type="hidden" name="id" value="<% $id %>">
    <input type="hidden" name="_action" value="ADD_PICTURE">
    <table border="0" width="100%">
        <tr align="left" class="<% $cssitem{0} %>">
            <td align="left">
            Add New Picture: &nbsp;<input type="file" name="__picture" size="30" value="">
	        &nbsp;<input type="submit" name="__picture_add" value="Add">
            </td>
        </tr>
    </table>
    </form>
%   }

</td>
</tr>
</table>
% }
<!-- End Closet Picture Table -->


% if (defined($o)) {
<table border="0" width="95%" align="center" class="tablebackground">
<tr valign="top">
    <td width="50%" valign="top">
<!-- Begin BackboneCable Table -->
<%perl>
my @sites;
if ($editBackbones) {
    @sites = Site->retrieve_all();
    @sites = sort { $a->name cmp $b->name } @sites;
}
</%perl>

<A NAME="backbones"></A>
<table border="0" width="100%" align="left"  class="tablebackground">
    <tr>
    <td valign="top" width="50%" align="left">
    <%perl>
    my @bbones;
    map { push (@bbones, $_) } ($o->backbones_start, $o->backbones_end);
    </%perl>
%	if (scalar(@bbones)) {
    
    <form name="bbone_form" action="closet.html" method="POST">
    <input type="hidden" name="id" value="<% $id %>">
    <input type="hidden" name="_action" value="UPDATE">
    <input type="hidden" name="s2name" value="<% $s2name %>">

    <table border="0" width="100%"  class="formtablebg" cellpadding="0" cellspacing="2">
    <tr class="formtabletitle">
     <td colspan="2">
      <table width="100%" border="0">
       <tr>
         <td width="10%" align="left">&nbsp;</td>
         <th width="70%" align="center">Backbone Cable</th>
%	 if ($editBackbones) {	 
            <td width="20%" align="right"><input type="button" name="cancel_button" value="cancel" onClick="history.go(-1);"> &nbsp;&nbsp; <input name="submit" value="save" type="submit"></td>
%	 } else {
            <td width="20%" align="right">
                <a href="cable_backbone.html?id=NEW">[new]</a>
            </td>
%	 }
       </tr>
      </table>
     <td>
   </tr>
   <tr>
     <td>
      <table border="0" width="90%">
    <tr>
        <td align="left">
            <a href="closet.html?id=<% $id %>&bb_sort=name#backbones">Name</a>
        </td>
        <td align="left">
            <a href="closet.html?id=<% $id %>&bb_sort=type#backbones">Type</a>
        </td>
        <td align="left">
            <a href="closet.html?id=<% $id %>&bb_sort=start_closet#backbones">Start Closet</a>
        </td>
        <td align="left">
            <a href="closet.html?id=<% $id %>&bb_sort=end_closet#backbones">End Closet</a>
        </td>
        <td align="left">
            <a href="closet.html?id=<% $id %>&bb_sort=owner#backbones">Owner</a>
        </td>
    </tr>

    <%perl>
    $bb_sort = "name" if (!defined($bb_sort) || $bb_sort eq "");
    my @sorted_bbones;
    if ($bb_sort eq "name")
    {
        @sorted_bbones = sort { $a->name cmp $b->name } @bbones;
    } elsif ($bb_sort eq "start_closet") {
        @sorted_bbones = sort { $a->start_closet->name cmp $b->start_closet->name } @bbones;
    } elsif ($bb_sort eq "end_closet") {
        @sorted_bbones = sort { $a->end_closet->name cmp $b->end_closet->name } @bbones;
    } elsif ($bb_sort eq "owner") {
        @sorted_bbones = sort { $a->owner->name cmp $b->owner->name } @bbones;
    } else {
        @sorted_bbones = sort { $a->$bb_sort cmp $b->$bb_sort } @bbones;
    }
    </%perl>

%   my $i = 0;
%   foreach my $bb (@sorted_bbones) {
%   $i = ($i + 1) % 2;
    <tr align="left" class="<% $cssitem{$i} %>">
        <td align="left">
%       if ($editBackbones) {
            <input type="checkbox" name="<% "BackboneCable__" . $bb->id . "__delete" %>">[del]
%           $ui->text_field(object=>$bb, table=>"BackboneCable", column=>"name",
%                          edit=>$editBackbones);
%       } else {
            <a href="cable_backbone.html?id=<% $bb->id %>"><% $bb->name %></a>
%       }
        </td>
        
        <td align="left">
%           $ui->select_lookup(object=>$bb, table=>"BackboneCable", column=>"type", 
%                             lookup=>"CableType", edit=>$editBackbones);
        </td>

        <td align="left">
%       if (!$editBackbones) {
            <a href="closet.html?id=<% $bb->start_closet %>"><% $bb->start_closet->name %></a>
%       } else {
            <script language="JavaScript">
            <!--
            var startClosetList_<% $bb->id %> = new DynamicList("bbone_form", "BackboneCable__<% $bb->id %>__start_closet", "site", "Closet", "start_site_list<% $bb->id %>_srch");
            LIST_MANAGER.addList(startClosetList_<% $bb->id %>);
            -->
            </script>
            <SELECT NAME="start_site_list<% $bb->id %>_srch" onChange="startClosetList_<% $bb->id %>.doIt();">
            <OPTION VALUE="">Lookup by Site</OPTION>
            <%perl>
            foreach my $s (@sites)
            {
                printf("<OPTION VALUE=\"%s\">%s</OPTION>\n", $s->id, $s->name);
            }
            </%perl>
            </SELECT> &nbsp;
            
%           $ui->select_lookup(object=>$bb, table=>"BackboneCable", column=>"start_closet", 
%                             lookup=>"Closet", where=>{site=>($bb ? $bb->start_closet->site : "")}, 
%                             edit=>$editBackbones);
%       }
        </td>

        <td align="left">
%       if (!$editBackbones) {
            <a href="closet.html?id=<% $bb->end_closet %>"><% $bb->end_closet->name %></a>
%       } else {
            <script language="JavaScript">
            <!--
            var endClosetList_<% $bb->id %> = new DynamicList("bbone_form", "BackboneCable__<% $bb->id %>__end_closet", "site", "Closet", "end_site_list<% $bb->id %>_srch");
            LIST_MANAGER.addList(endClosetList_<% $bb->id %>);
            -->
            </script>
            <SELECT NAME="end_site_list<% $bb->id %>_srch" onChange="endClosetList_<% $bb->id %>.doIt();">
            <OPTION VALUE="">Lookup by Site</OPTION>
            <%perl>
            foreach my $s (@sites)
            {
                printf("<OPTION VALUE=\"%s\">%s</OPTION>\n", $s->id, $s->name);
            }
            </%perl>
            </SELECT> &nbsp;

%           $ui->select_lookup(object=>$bb, table=>"BackboneCable", column=>"end_closet", 
%                             lookup=>"Closet", where=>{site=>($bb ? $bb->end_closet->site : "")},
%                             edit=>$editBackbones);
%       }
        </td>

        <td align="left">
%           $ui->select_lookup(object=>$bb, table=>"BackboneCable", column=>"owner", 
%                             lookup=>"Entity", edit=>$editBackbones);
        </td>
    </tr>
%   }
    <tr align="left" valign="top">
        <td align="left" colspan="4">

        </td>
    </tr>

    </table>
    </td>
    </tr>
    </table>
    </form>
%  }    
</td>
</tr>
</table>
<!-- End BackboneCable Table -->
    </td>

    <td width="50%" align="top">
<!-- Begin  HorizontalCable Table -->
    <A NAME="horizontal"></A>
<table border="0" width="100%" align="right" class="tablebackground">
    <tr>
    <td valign="top" width="50%" align="right">
    <%perl>
    my @cables;
    map { push (@cables, $_) } $o->horizontalcables;
    </%perl>
%	if (scalar(@cables)) {
    
    <form name="cable_form" action="closet.html" method="POST">
    <input type="hidden" name="id" value="<% $id %>">
    <input type="hidden" name="_action" value="UPDATE">
    <input type="hidden" name="s2name" value="<% $s2name %>">

    <table border="0" width="100%"  class="formtablebg" cellpadding="0" cellspacing="2">
    <tr class="formtabletitle">
     <td colspan="2">
      <table width="100%" border="0">
       <tr>
         <td width="10%" align="left">&nbsp;</td>
         <th width="70%" align="center">Horizontal Cable</th>
%	 if ($editHorizontal) {
            <td width="20%" align="right"><input type="button" name="cancel_button" value="cancel" onClick="history.go(-1);"> &nbsp;&nbsp; <input name="submit" value="save" type="submit"></td>
%	 } else {
            <td width="20%" align="right">
                <a href="cable_horizontal.html?id=NEW">[new]</a>
            </td>
%	 }
       </tr>
      </table>
     <td>
   </tr>
   <tr>
     <td>
      <table border="0" width="90%">
    <tr>
        <td align="left">
            <a href="closet.html?id=<% $id %>&cable_sort=jackid#horizontal">Jack ID</a>
        </td>
        <td align="left">
            <a href="closet.html?id=<% $id %>&cable_sort=type#horizontal">Type</a>
        </td>
        <td align="left">
            <a href="closet.html?id=<% $id %>&cable_sort=room#horizontal">Room</a>
        </td>
    </tr>

    <%perl>
    $cable_sort = "jackid" if (!defined($cable_sort) || $cable_sort eq "");
    my @sorted_cables;
    if ($cable_sort eq "jackid") {
        @sorted_cables = sort { $a->jackid cmp $b->jackid } @cables;
    } elsif ($cable_sort eq "type") {
        @sorted_cables = sort { $a->type->name cmp $b->type->name } @cables;
    } elsif ($cable_sort eq "room") {
        @sorted_cables = sort { $a->room->name cmp $b->room->name } @cables;
    } else {
        @sorted_cables = sort { $a->$cable_sort cmp $b->$cable_sort } @cables;
    }
    </%perl>

%   my $i = 0;
%   foreach my $cable (@sorted_cables) {
%   $i = ($i + 1) % 2;
    <tr align="left" class="<% $cssitem{$i} %>">
        <td align="left">
%       if ($editHorizontal) {
            <input type="checkbox" name="<% "HorizontalCable__" . $cable->id . "__delete" %>">[del]
%           $ui->text_field(object=>$cable, table=>"HorizontalCable", column=>"jackid",
%                          edit=>$editHorizontal);
%       } else {
            <a href="cable_horizontal.html?id=<% $cable->id %>"><% $cable->jackid %></a>
%       }
        </td>
        
        <td align="left">
%           $ui->select_lookup(object=>$cable, table=>"HorizontalCable", column=>"type", 
%                             lookup=>"CableType", edit=>$editHorizontal);
        </td>

        <td align="left">
            <a href="view.html?table=Room&id=<% $cable->room %>"><% $cable->room->name %></a>
        </td>
    </tr>
%   }
    <tr align="left" valign="top">
        <td align="left" colspan="4">
        </td>
    </tr>
    </table>
    </td>
    </tr>
    </table>
    </form>
%  }    
</td>
</tr>
</table>
<!-- End HorizontalCable Table -->
    
    </td>
</tr>
</table>
% }
