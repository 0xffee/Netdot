<%doc>

Floor interface

</%doc>

<%args>
$id     => undef;
$edit   => undef;
</%args>

<%flags>
inherit => 'section_cable.html' 
</%flags>

<%attr>
title   => 'Floor' 
section => 'Plant'
</%attr>

<%init>
my $DEBUG     = 0;
my $o         = undef;
my $site      = undef;
my $editFloor = 0;

if ($id && $id ne "NEW") {
   $o = Floor->retrieve($id);
   $site = $o->site;
}

$editFloor = 1 if ($id eq "NEW" || $edit eq "floorinfo");
</%init>

<%perl>
print "<pre>", Dumper(%ARGS), "</pre><br>" if $DEBUG;

# code for inserting/updating
# -----------------------------------------------------------------------------
if (defined($ARGS{_action})) {
    my %update_info = ();
    print "ARGS is  <pre>", Dumper(%ARGS), "</pre><br>" if $DEBUG;
    if (!(%update_info = $ui->form_to_db(%ARGS))) {
        $m->comp("error.mhtml", $ui->error());
	}

    if ($update_info{Floor}{key}) {
        $id = $update_info{Floor}{key};
        $editFloor = 0;
    }

    # Do this to 'flush' the values associated with the object
    # before redisplaying
    $o = undef;
    $site = undef;
    if ($id && $id ne "NEW") {
        $o = Floor->retrieve($id);
        $site = $o->site;
    }
}
# end insertion/update code
# -----------------------------------------------------------------------------
</%perl>

<div class="containeroutside">
% if ($site) {
   <div class="containerheadoutside">
      Floor for Site: <a href="cable_plant.html?id=<% $site->id %>&page_type=HORIZONTAL"><% $site->name %></a>
   </div>
% }

   <div class="container">
      <div class="containerheadleft">Floor</div>
      <form name="floorform" action="floor.html" method="POST" enctype="multipart/form-data">
         <input type="hidden" name="id" value="<% $id %>">
         <input type="hidden" name="_action" value="1">

         <div class="containerheadright">
% if ($editFloor) {
            <input type="button" name="cancel_button" value="cancel" onClick="history.go(-1);"> <input name="submit" value="save" type="submit">
% } else {
            <a href="floor.html?id=NEW">[new]</a> <a href="floor.html?id=<% $id %>&edit=floorinfo">[edit]</a> <a href="delete.html?table=Floor&id=<% $id %>">[delete]</a>
% }
         </div>

         <div class="containerbody">
	    <%perl>
	    my (@field_headers, @cell_data) = ();

	    push( @field_headers, "Level: " );
	    push( @cell_data, $ui->text_field(object=>$o, table=>"Floor", column=>"level",edit=>$editFloor, returnAsVar=>1) );
	    push( @field_headers, "Site: " );
	    push( @cell_data, $ui->select_lookup(object=>$o, table=>"Floor", column=>"site", lookup=>"Site", edit=>$editFloor, returnAsVar=>1) );
	    </%perl>
	    <& attribute_table.mhtml, field_headers=>\@field_headers, data=>\@cell_data &>

	    <div class="containerseparator">Comments:</div>
%           $ui->text_area(object=>$o, table=>"Floor", column=>"info", edit=>$editFloor, htmlExtra=>"rows='3' cols='80'");
         </div>	      

      </form>
   </div>
</div>