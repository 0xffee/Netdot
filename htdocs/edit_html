<%perl>
foreach my $j ( keys %ARGS ) {
  if( $j eq "args" ) {
    %args = %{ $ARGS{$j} };
    next;
  }
  if( $j eq "state" ) {
    %state = %{ $ARGS{$j} };
    next;
  }
  if( $j eq "id" ) {
    $ID = $ARGS{id};
  }
  if( $j eq "table" ) {
    $TBL = $ARGS{table};
  }
  if( $j eq "obj" ) {
    $OBJ = $ARGS{obj};
  }
  if( $j eq "new" ) {
    $NEW = $ARGS{new};
  }
  if( $j eq "sid" ) {
    $sid = $ARGS{sid};
  }
  if( $j eq "session" ) {
    $session = $ARGS{session};
  }
}
</%perl>
% ####################################################################
<%doc>

This block catches the case where we've confirmed a submission and now
want to go to the page to view it

</%doc>
% if( $args{confirm} eq "Confirm" && ( ! $TBL || $args{cancel} ) ) {
    <& view.html, table => $args{create}, id => $ID &>
% ####################################################################
% } else {
<%doc>

Okay, we're still working.  Let's insert a header

</%doc>
%   if( $args{submit} eq "Submit" ) {
      <& header, title => "Confirm: $TBL" &>
%   } elsif( $OBJ ) {
%     my $labelstr = $gui->getobjlabel($OBJ, ", ");
      <& header, title => "Edit: $TBL: $labelstr" &>
%   } else {
      <& header, title => "Create: $TBL" &>
%   }
    <!-- begin edit -->
    <p>
% ####################################################################
<%doc>

The user has clicked on submit.  Let's present a page for user to confirm
the submission.

</%doc>
%   if( $args{"submit"} eq "Submit" ) {
      <p>Please confirm the following:
%     my $obj = $gui->getmeta( $TBL );
%     my %linksto = $gui->getlinksto( $TBL );
      <p><blockquote><strong><% $TBL %></strong><ul>
%     foreach my $C ( split( /,/, $obj->columnorder() ) ) {
        <li>
        <% $C %> :
%       if( ! exists( $session->{tables}{$TBL}{$C} ) ) {
          -
%       } else {
%         if( $linksto{$C} ) {
%           my $ft = $gui->getmeta( $linksto{$C} );
%           if( ! defined( $ft ) ) {
              No such object <% $linksto{$C} %>
%           } elsif( $session->{tables}{$TBL}{$C} == 0 ) {
              -
%           } elsif( ! defined( $linksto{$C}->
%                    retrieve( int( $session->{tables}{$TBL}{$C} ) ) ) ) {
              -
%           } else {
%             my $o = $linksto{$C}->retrieve( $session->{tables}{$TBL}{$C} );
%             my $lbl = $gui->getobjlabel( $o, ", " );
              <% $lbl %>
%           }
%         } else {
            <% $session->{tables}{$TBL}{$C} %>
%         }
%       }
%     }
      </ul></blockquote>
      <form name="netdotform" action="edit.html" method="POST">
      <input type="hidden" name="sid" value="<% $sid %>">
      <input type="hidden" name="create" value="<% $TBL %>">
%     if( $ID ) {
      <input type="hidden" name="id" value="<% $ID %>">
%     }
      <input name="confirm" value="Confirm" type="submit">
      <input name="cancel" value="Cancel" type="submit">
      </form>
%   ##############################################
<%doc>

We were called without any arguments.  Present a default listing of
available tables.

</%doc>
%   } elsif( ! $TBL ) {
      <p>
      <blockquote>
      <& table, width => $WIDTH, link => "edit.html", title => "Please select an object to create:" &>
      </blockquote>
%   ##############################################
    } elsif( $args{cancel} ) {
<%doc>

User has clicked on cancel.

</%doc>
      <p>
      <blockquote>
      <& table, width => $WIDTH, link => "edit.html", title => "Please select an object to create:" &>
      </blockquote>
%   ##############################################
%   } else {
<%doc>

Present a form for user to modify various values.

</%doc>
      <br>
      <blockquote>
      <form name="netdotform" action="edit.html" method="POST">
      <input type="hidden" name="sid" value="<% $sid %>">
%     ############################################
%     # special clause for node
%     if( $TBL eq "Node" ) {
        <a href="node.html">Auto Discover Node</a><br>
        <p>
%     }
%     ############################################
%     if( $ID && ! $NEW ) {
      <& form, table => $TBL, showdisabled => '0', id => $ID &>
%     } else {
%       if( $ID ) {
      <input type="hidden" name="id" value="<% $ID %>">
%       }
      <& form, table => $TBL, showdisabled => '0', session => \%state &>
%     }
      <table cellpadding="3" cellspacing="1" border="0">
      <tr align="LEFT">
      <td bgcolor="#FFFFFF" align="CENTER" colspan="3">
      <input name="submit" value="Submit" type="submit">
      </td>
      <td>
      <input name="cancel" value="Cancel" type="submit">
      </td>
      </tr>
      </table>
      </form>
      </blockquote>
%   } # if/else table
    <p>
    <!-- end edit -->
    <& footer &>
% }

<%args>
$ID => undef
$TBL => undef
$OBJ => undef
$NEW => undef
$sid => undef
$WIDTH => 2
$session => undef
$gui => Netdot::GUI->new()
%args => undef
%state => undef
</%args>
