<%doc>
Zone UI
</%doc>
%
%
<%attr>
title   => 'Zone' 
section => 'Management'
</%attr>
%
%
<%args>
$id
$user => $ui->get_current_user($r)
$view => undef
$edit => undef
</%args>
%
%
<%init>
my $DEBUG = 0;
print '%ARGS is  <pre>', Dumper(%ARGS), '</pre><br>' if $DEBUG;

my $obj = Zone->retrieve($id);

# Check if user can view this object
my $manager = $ui->get_permission_manager($r);
unless ( $manager && $manager->can($user, "view", $obj) ){
    $m->comp('/generic/error.mhtml', error=>"You don't have permission to view this object");
}

my $count = $obj->get_record_count();
</%init>

<div id="sectiondetail">

%###########################################################################
<!-- Display main object values -->
<div class="container">
    <div class="containerheadleftoutside"><strong>Zone <% $obj->name %></strong></div>
    <div class="containerheadrightoutside">
          <a href="zone.html?id=<% $id %>">[refresh]</a>
%         if ( $manager && $manager->can($user, "access_section") ){
%           # Only admins can do this
            <a href="edit.html?table=Zone">[new]</a>
            <a href="edit.html?table=Zone&id=<% $id %>">[edit]</a>
            <a href="delete.html?table=Zone&id=<% $id %>">[delete]</a>
%         }
          <a href="#" onClick="opentextwindow(jspopoutstring,'js','');">[text]</a>
    </div>
    <div class="containerbodyoutside">
        <& /generic/form.mhtml, table=>"Zone", id=>$id, edit=>0 &>
    </div>
</div>
<!-- End Display main object values -->

%###########################################################################
% my @headers;
% my @rows;

 <div class="container">
   <div class="containerhead">Record Count</div>
%   my $total = 0;
%   foreach my $rtype ( sort keys %$count ){
%        $total += $count->{$rtype};
%        push @headers, uc($rtype);
%        push @rows, $count->{$rtype};
%    }
%    push @headers, '<b>TOTAL</b>';
%    push @rows, $total;
%    $m->comp('/generic/attribute_table.mhtml', width=>"4", field_headers=>\@headers, data=>\@rows);
    </div>
</div>



%###########################################################################
%# This zone's records
% if ( my $at = RR->search(name=>'@', zone=>$id)->first ){

%    if ( my @a_records = $at->arecords ){
    <div class="container">
       <div class="containerhead">Address Records</div>
          <& /generic/sortresults.mhtml, object=>\@a_records &>
     </div>
%    }

%    if ( my @nslist = $at->ns_records ){
    <div class="container">
       <div class="containerhead">Name Servers (NS)</div>
          <& /generic/sortresults.mhtml, object=>\@nslist &>
     </div>
%    }

%    if ( my @mxlist = $at->mx_records ){
    <div class="container">
       <div class="containerhead">Mail Exchangers (MX)</div>
          <& /generic/sortresults.mhtml, object=>\@mxlist &>
     </div>
%    }

% }

<!-- Display list of SubnetZone relationships -->
%###########################################################################
% if ( my @sz = $obj->subnets ){
      <div class="container">
        <div class="containerheadleft">IP Blocks</div>
%       if ( $edit eq 'ipblocks' ){
	  <div class="containerheadright">&nbsp;</div>
%       }else{
	  <div class="containerheadright"><a href="zone.html?id=<% $id %>&edit=ipblocks">[edit]</a></div>
%       }
        <& /generic/sortresults.mhtml, object=>\@sz, withedit=>($edit eq 'ipblocks')? 1 : 0  &>
      </div>
% }

<!-- Display view menu -->
   <div class="container">
% if ( $view eq 'records' ){
      <div class="containerheadleft">Records</div>
%      if ( $edit eq 'records' ){
	  <div class="containerheadright">&nbsp;</div>
%      }else{
	  <div class="containerheadright"><a href="zone.html?id=<% $id %>&edit=records">[edit]</a></div>
%      }
% }else{
      <div class="containerheadleft"><a href="zone.html?id=<% $id %>&view=records">[view records]</a></div>
      <div class="containerheadright">&nbsp;</div>
% }

<!-- Display list of records -->
% if ( $view eq 'records' || $edit eq 'records' ){
%     my @records = $obj->records;
      <div class="containerbody">
      <& /generic/sortresults.mhtml, object =>\@records, withedit=>($edit eq 'records')? 1 : 0, return_args=>"?id=$id" &>
      </div>
   </div>
% }
