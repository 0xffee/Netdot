<%doc>
Device Inventory Report

</%doc>

<%flags>
inherit => 'section_reports.html' 

</%flags>

<%attr>
title   => 'Device Inventory' 
section => 'Reports'
</%attr>

<%init>
my $DEBUG      = 0;
my $grandtotal = 0;

</%init>

    <table border="0" cellpadding="4" cellspacing="0" width="100%" class="formtablebg">
       <tr class="formtabletitle">
	  <th valign="top">Type</th>
	  <th valign="top">Product</th>
	  <th valign="top">Count</th>
       </tr>
%    foreach my $pt (sort { $a->name cmp $b->name } ProductType->retrieve_all){
%      my $totaldevs = 0;
%      my @objs = $dm->getproductsbytype($pt);
       <tr class="formtablec2">
	  <td valign="top" ><strong><% $pt->name %></strong></td>
	  <td valign="top"></td>
	  <td valign="top"></td>
       </tr>
%       foreach my $o (@objs){
%       $totaldevs += $o->numdevs;
%       $grandtotal += $totaldevs;
       <tr>
	  <td valign="top"></td>
	  <td valign="top"><a href="view.html?table=Product&id=<% $o->id %>"><% $o->name %></a></td>
	  <td valign="top"><% $o->numdevs %></td>
       </tr>

%       }
%      # Give total per type
%       if ($totaldevs){
          <tr>
	   <td valign="top"></td>
	   <td valign="top">Total</td>
	   <td valign="top"><% $totaldevs %></td>
          </tr>
%       }
%    }
%# Look for unset types
%      my $totaldevs = 0;
%      my @objs = $dm->getproductsbytype(0);
%      if (scalar @objs){
       <tr>
	  <td valign="top"><strong>Unknown Type</strong></td>
	  <td valign="top"></td>
	  <td valign="top"></td>
       </tr>
%         foreach my $o (@objs){
%           $totaldevs += $o->numdevs;
%           $grandtotal += $totaldevs;
            <tr>
		<td valign="top"></td>
		<td valign="top"><a href="view.html?table=Product&id=<% $o->id %>"><% $o->name %></a></td>
		<td valign="top"><% $o->numdevs %></td>
            </tr>

%         }
%         if ($totaldevs){
            <tr>
	     <td valign="top"></td>
	     <td valign="top">Total</td>
	     <td valign="top"><% $totaldevs %></td>
            </tr>
%         }
%      }
%# Present total
       <tr class="formtabletitle">
	  <td valign="top"></td>
	  <td valign="top"><strong>Total</strong></td>
	  <td valign="top"><strong><% $grandtotal %></strong></td>
       </tr>

    </table>

