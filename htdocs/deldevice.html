<%doc>

   Manage Device deletions.  Ask about deleting DNS Resource Records as well.

</%doc>

<%flags>
inherit => 'section_management.html' 
</%flags>

<%attr>
title   => 'Delete Device' 
section => 'Management'
</%attr>

<%args>
$id
$submit    => undef
</%args>

<%init>
my $o;
my $name;
my $DEBUG = 0;

printf ("<pre>%s</pre>", Dumper(%ARGS)) if $DEBUG;

if ($id){
   $o = Device->retrieve($id);
   $name = ($o->name && $o->name->name) ? $o->name->name : "Name N/A!";
}

</%init>

<div id="sectiondetail">

% if (! $submit ){
<div class="container">
    <div class="containerhead">
    	Going to delete device <% $name %>
    </div>

    <div class="containerbody">

    <form action="delete.html" method="POST">
    <input type="hidden" name="Device__<% $id %>" value="on">
    <p>Delete DNS records?<p>
    <table border="0" class="formtablebg">
%   if ($o->name){
<%doc>
  Delete DNS RR's associated with the device, including all interfaces
</%doc>
       <tr>
          <td><% $o->name->name %></td>
          <td><input type="checkbox" name="RR__<% $o->name->id %>" CHECKED><br></td> 
       </tr>
%   }
%   if ( my @ints = $o->interfaces ){
%     foreach my $int (@ints){
%       if ( my @ips = $int->ips ){
%         foreach my $ip ( @ips ){
%           if ( my @ras = $ip->arecords ){
%             foreach my $ra ( @ras ){
%               next if ( $ra->rr->id eq $o->name->id );
                <tr>
                  <td><% $ra->rr->name %></td>
                  <td><input type="checkbox" name="RR__<% $ra->rr->id %>" CHECKED><br></td>
                </tr>
%             }
%           }	      
%         }
%       }
%     }
%   }
    </table>
    <br>
    <input type="submit" name="submit" value="Delete">
    <input type="submit" name="submit" value="Cancel">
    </form>

    </div> <!-- close containerbody -->
</div> <!-- close container -->
%}

</div> <!-- close sectiondetail -->
