<%doc>

This block catches the case where we have confirmed a submission and now
want to go to the page to view it

</%doc>

<%args>
$ID         => undef
$TBL        => undef
$OBJ        => undef
$NEW        => undef
$sid        => undef
$WIDTH      => 2
$session    => undef
%args       => undef
%state      => undef
$showheader => 1
</%args>

<%init>
my $title;
foreach my $j ( keys %ARGS ) {
  if( $j eq "args" ) {
    %args = %{ $ARGS{$j} };
    next;
  }
  if( $j eq "state" ) {
    %state = %{ $ARGS{$j} };
    next;
  }
  if( $j eq "id" ) {
    $ID = $ARGS{id};
  }
  if( $j eq "table" ) {
    $TBL = $ARGS{table};
  }
  if( $j eq "obj" ) {
    $OBJ = $ARGS{obj};
  }
  if( $j eq "new" ) {
    $NEW = $ARGS{new};
  }
  if( $j eq "sid" ) {
    $sid = $ARGS{sid};
  }
  if( $j eq "session" ) {
    $session = $ARGS{session};
  }
}

my $page;
if ( $showheader ) {
    $page = "edit.html";
}else{
    $page = "edit-nh.html";
}

</%init>

% if( $args{cancel} && $TBL && $ID
%     && $args{table} eq $TBL
%     && ( ! defined( $session->{path} ) || length( $session->{path} ) < 1 ) ){
      <& view.html, table => $TBL, id => $ID &>
% } elsif( $args{confirm} eq "Confirm" && ( ! $TBL || $args{cancel} ) ) {
%    if ( $showheader ){
      <& view.html, table => $args{create}, id => $ID &>
%    }else{
%      my $obj = $args{create}->retrieve($ID);
%      my $lbl = $ui->getobjlabel($obj);
       <head>
         <link rel=StyleSheet href="style.css" type="text/css">
         <link rel="alternate stylesheet" title="Gray" href="style-gray.css" type="text/css">
         <title>Netdot : Create Object</title>
       </head>      
         <body class="bodytag" onUnload="opener.setselect(<% "\'" . $ID . "\'" %>, <% "\'" . $lbl . "\'" %>)">
           <a href="#" onClick="window.close()">[done]</a>
         </body>      
%    }
% ####################################################################
% } else {

    <head>
      <link rel=StyleSheet href="style.css" type="text/css">
      <link rel="alternate stylesheet" title="Gray" href="style-gray.css" type="text/css">
      <title>Netdot </title>
    </head>      
      <body class="bodytag">

    <!-- begin edit -->
% ####################################################################
<%doc>

The user has clicked on submit.  Present a page for user to confirm
the submission.

</%doc>
%   if( $args{"submit"} eq "Submit" ) {
    <table width="100%" cellpadding="0" cellspacing="0" border="0" class="formtablebg">
      <tr class="rowtitle0" >
        <td align="CENTER"><strong><% $title %></strong></td>
      </tr>
      <tr><td>
      <p>Please confirm the following:
%     my $obj = $ui->getmeta( $TBL );
%     my %linksto = $ui->getlinksto( $TBL );
%     my %tags = $ui->getcolumntags( $TBL );
      <p><blockquote><strong><% $TBL %></strong><ul>
%     foreach my $C ( split( /,/, $obj->columnorder() ) ) {
        <li>
% 	if ( exists($tags{$C}) ){
           <% $tags{$C} %> :
%	}else{
           <% $C %> :	   
%	}
%       if( ! exists( $session->{tables}{$TBL}{$C} ) ) {
          -
%       } else {
%         if( $linksto{$C} ) {
%           my $ft = $ui->getmeta( $linksto{$C} );
%           if( ! defined( $ft ) ) {
              No such object <% $linksto{$C} %>
%           } elsif( $session->{tables}{$TBL}{$C} == 0 ) {
              -
%           } elsif( ! defined( $linksto{$C}->
%                    retrieve( int( $session->{tables}{$TBL}{$C} ) ) ) ) {
              -
%           } else {
%             my $o = $linksto{$C}->retrieve( $session->{tables}{$TBL}{$C} );
%             my $lbl = $ui->getobjlabel( $o, ", " );
              <% $lbl %>
%           }
%         } else {
            <% $session->{tables}{$TBL}{$C} %>
%         }
%       }
%     }
      </td></tr>
      <tr class="rowtitle0" >
      <td align="CENTER">
      </ul></blockquote>
      <form name="netdotform" action="<% $page %>" method="POST">
      <input type="hidden" name="sid" value="<% $sid %>">
      <input type="hidden" name="create" value="<% $TBL %>">
      <input type="hidden" name="showheader" value="<% $showheader %>">
%     if( $ID ) {
      <input type="hidden" name="id" value="<% $ID %>">
%     }
      <input name="confirm" value="Confirm" type="submit">
      <input name="cancel" value="Cancel" type="submit">
      </form>
      </td>
      </tr>
      </table>
%   ##############################################
<%doc>

We were called without any arguments.  Present a default listing of
available tables.

</%doc>
%   } elsif( ! $TBL ) {
      <p>
      <blockquote>
      <& table.mhtml, width => $WIDTH, link => "<% $page %>", title => "Please select an object to create:" &>
      </blockquote>
%   ##############################################
%   } else {
<%doc>

Present a form for user to modify various values.

</%doc>
      <table width="100%" cellpadding="0" cellspacing="0" border="0" class="tablebackground">
       <tr class="rowtitle0" >
        <td align="CENTER"><strong><% $title %></strong></td>
       </tr>
       <tr><td>
      <form name="netdotform" action="<% $page %>" method="POST">
      <input type="hidden" name="sid" value="<% $sid %>">
      <input type="hidden" name="showheader" value="<% $showheader %>">
%     if( $ID && ! $NEW ) {
      <& form.mhtml, table => $TBL, id => $ID &>
%     } else {
%       if( $ID ) {
      <input type="hidden" name="id" value="<% $ID %>">
%       }
      <& form.mhtml, title => $title, table => $TBL, session => \%state &>
%     }
       </td></tr>
       <tr class="rowtitle0" >
        <td align="CENTER">
           <input name="submit" value="Submit" type="submit">
           <input name="cancel" value="Cancel" type="submit">
         </td>
       </tr>
      </table>
      </form>
%   } # if/else table
    <p>
    <!-- end edit -->
% }
