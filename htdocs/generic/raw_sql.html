<%doc>

 Generic Database Operations Section.

</%doc>

<%args>
$sql    => undef
$action => undef
</%args>

<%attr>
title   => 'Direct SQL Commands' 
section => 'Generic'
</%attr>

<%init>
my $result;
my $sql_err;
if ( $action eq "DO_SQL" ){
    eval {
	$result = Netdot::Model->raw_sql($sql);
    };
    if ( my $e = $@ ){
	$sql_err = $e;
    }
}
</%init>

<div class="container">
    <div class="containerhead">
        Direct SQL Commands
    </div>

    <div class="containerbody">

    <p><b>Be Careful!</b></p>

    <form action="<% $r->dir_config('NetdotPath') %>generic/" method="POST">
      <input type="hidden" name="action" value="DO_SQL">
      SQL query: <input type="text" size="80" name="sql" value="<% $sql | h %>">
      <input name="submit" value="Go" type="submit">
    </form>
 
    </div> <!-- close containerbody -->
</div> <!-- close container -->



% if ( $action eq "DO_SQL" ){
    <div class="container">
        <div class="containerhead">Query Results:</div>
        <div class="containerbody">
<%perl>
    if ( defined $result && scalar $result->{rows} ){
        my @headers = $result->{headers};
        my @rows    = $result->{rows};

	$m->comp('data_table.mhtml', field_headers=>@headers, data=>@rows);

    }elsif ( $sql_err ){
        print $sql_err, "<br>";    
    }
</%perl>
        <br>
       </div> <!-- close containerbody -->
    </div> <!-- close container -->
% }
