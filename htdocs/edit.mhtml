<%doc>

HTML code for edit.html component

</%doc>

<%args>
$ID         => undef
$TBL        => undef
$OBJ        => undef
$sid        => undef
$WIDTH      => 2
$session    => undef
%args       => undef
%state      => undef
$showheader => 1
$select_id  => undef
</%args>

<%init>

foreach my $j ( keys %ARGS ) {
  if( $j eq "args" ) {
    %args = %{ $ARGS{$j} };
    next;
  }
  if( $j eq "state" ) {
    %state = %{ $ARGS{$j} };
    next;
  }
}

my $page;
if ( $showheader ) {
    $page = "edit.html";
}else{
    $page = "edit-nh.html";
}

my $title = $TBL || "Edit";

$select_id = $args{select_id};

</%init>

<%doc>

This block catches the case where we have confirmed a submission and now
want to go to the page to view it

</%doc>

% if( $args{cancel} && $TBL && $ID
%     && $args{table} eq $TBL
%     && ( ! defined( $session->{path} ) || length( $session->{path} ) < 1 ) ){
      <& view.html, table => $TBL, id => $ID &>
% } elsif( $args{confirm} eq "Confirm" && ( ! $TBL || $args{cancel} ) ) {
%    if ( $showheader ){
      <& view.html, table => $args{create}, id => $ID &>
%    }else{
%      my $obj = $args{create}->retrieve($ID);
%      my $lbl = $ui->getobjlabel($obj);
       <head>
         <link rel="stylesheet" href="style.css" type="text/css">

<script language="javascript" type="text/javascript">
<!--
// this code inserts an element into the select box in the
// calling page's form, and selects the new element.
function insertOption(text, value) {
  var select_box = opener.document.getElementById('<% $select_id %>');
  var elOptNew = document.createElement('option');
  elOptNew.text = text;
  elOptNew.value = value;
  try {
    select_box.add(elOptNew, null); // standards compliant; doesn't work in IE
  }
  catch(ex) {
    select_box.add(elOptNew); // IE only
  }
  select_box.selectedIndex = select_box.length-1;
}

//-->
</script>

       </head>      
         <body onLoad="insertOption('<% $lbl %>', <% $ID %>);window.close();">
           <a href="#" onClick="window.close()">[done]</a>
         </body>      
%    }
% ####################################################################
% } else {
%    if ( !$showheader ){
    <head>
      <link rel="stylesheet" href="style.css" type="text/css">
      <title>Netdot </title>
    </head>      
      <body>
%    }
    <!-- begin edit -->
% ####################################################################
<%doc>

The user has clicked on submit.  Present a page for user to confirm
the submission.

</%doc>

% if ( $showheader ){
    <div id="sectiondetail">
% }

%   if( $args{"submit"} eq "Submit" ) {
    <table width="100%" cellpadding="0" cellspacing="0" border="0" class="formtablebg">
      <tr class="rowtitle0" >
        <td align="CENTER"><strong><% $title %></strong></td>
      </tr>
      <tr><td>
      <p>Please confirm the following:
%     my $obj = $ui->getmeta( $TBL );
%     my %linksto = $ui->getlinksto( $TBL );
%     my %tags = $ui->getcolumntags( $TBL );
      <p><blockquote><strong><% $TBL %></strong><ul>
%     foreach my $C ( split( /,/, $obj->columnorder() ) ) {
        <li>
% 	if ( exists($tags{$C}) ){
           <% $tags{$C} %> :
%	}else{
           <% $C %> :	   
%	}
%       if( ! exists( $session->{tables}{$TBL}{$C} ) ) {
          -
%       } else {
%         if( $linksto{$C} ) {
%           my $ft = $ui->getmeta( $linksto{$C} );
%           if( ! defined( $ft ) ) {
              No such object <% $linksto{$C} %>
%           } elsif( $session->{tables}{$TBL}{$C} == 0 ) {
              -
%           } elsif( ! defined( $linksto{$C}->
%                    retrieve( int( $session->{tables}{$TBL}{$C} ) ) ) ) {
              -
%           } else {
%             my $o = $linksto{$C}->retrieve( $session->{tables}{$TBL}{$C} );
%             my $lbl = $ui->getobjlabel( $o, ", " );
              <% $lbl %>
%           }
%         } else {
            <% $session->{tables}{$TBL}{$C} %>
%         }
%       }
%     }
      </td></tr>
      <tr class="rowtitle0" >
      <td align="CENTER">
      </ul></blockquote>
      <form name="netdotform" action="<% $page %>" method="POST">
      <input type="hidden" name="sid" value="<% $sid %>">
      <input type="hidden" name="create" value="<% $TBL %>">
      <input type="hidden" name="showheader" value="<% $showheader %>">
      <input type="hidden" name="select_id" value="<% $select_id %>">
%     if( $ID ) {
      <input type="hidden" name="id" value="<% $ID %>">
%     }
      <input name="confirm" value="Confirm" type="submit">
      <input name="cancel" value="Cancel" type="submit">
      </form>
      </td>
      </tr>
      </table>
%   ##############################################
<%doc>

We were called without any arguments.  Present a default listing of
available tables.

</%doc>
%   } elsif( ! $TBL ) {
      <p>
      <blockquote>
      <& table.mhtml, width => $WIDTH, link => "$page", title => "Please select an object to create:" &>
      </blockquote>
%   ##################### any validation checking. They are intended to pr#########################
%   } else {
<%doc>

Present a form for user to modify various values.

</%doc>

<div class="container">
    <div class="containerhead">
        <% $title %>
    </div>
    <div class="containerbody">
      <form name="netdotform" action="<% $page %>" method="POST">
      <input type="hidden" name="sid" value="<% $sid %>">
      <input type="hidden" name="showheader" value="<% $showheader %>">
      <input type="hidden" name="select_id" value="<% $select_id %>">
%     if( $ID ) {
      <& form.mhtml, table => $TBL, id => $ID &>
%     } else {
%       if( $ID ) {
      <input type="hidden" name="id" value="<% $ID %>">
%       }
      <& form.mhtml, title => $title, table => $TBL, session => \%state &>
%     }
      <br>
      <input name="submit" value="Submit" type="submit">
      <input name="cancel" value="Cancel" type="submit">
      </form>
    </div>
</div>
%   } # if/else table
    <p>
    <!-- end edit -->
% }

% if ( $showheader ){
    </div>
% }
