<%doc>

   Manage Device deletions.  Ask about deleting DNS Resource Records as well.

</%doc>

<%attr>
title   => 'Delete Device' 
section => 'Management'
</%attr>

<%args>
$id
$submit    => undef
</%args>

<%init>
my $o;
my $name;
my $DEBUG = 0;

printf ("<pre>%s</pre>", Dumper(%ARGS)) if $DEBUG;

if ($id){
   $o = Device->retrieve($id);
   $name = ($o->name && $o->name->name) ? $o->name->name : "Name N/A!";
}

my (@field_headers, @cell_data);

if ( $o->name ){
    push @field_headers, $o->name->name;
    my $rrid = $o->name->id;
    push @cell_data, qq/<input type="checkbox" name="RR__$rrid" CHECKED>/;
}
foreach my $ip ( $dm->getdevips( $o->id ) ){
    foreach my $ar ( $ip->arecords ){
	next if ( $ar->rr->id eq $o->name->id );
	push @field_headers, $ar->rr->name;
	my $arid = $ar->rr->id;
	push @cell_data, qq/<input type="checkbox" name="RR__$arid" CHECKED>/;
    }
}

</%init>

<div id="sectiondetail">

% if (! $submit ){
<div class="container">
    <div class="containerhead">
    	Going to delete device <% $name %>
    </div>

    <div class="containerbody">

        <form action="delete.html" method="POST">
        <input type="hidden" name="Device__<% $id %>" value="on">
        <p>Delete DNS records?<p>
        <& /generic/attribute_table.mhtml, field_headers=>\@field_headers, data=>\@cell_data, headercolwidth=>100 &>
        <input type="submit" name="submit" value="Delete">
        <input type="submit" name="submit" value="Cancel">
        </form>

    </div> <!-- close containerbody -->
</div> <!-- close container -->
%}

</div> <!-- close sectiondetail -->
