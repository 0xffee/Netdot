<%doc>

-- HOST tasks --

</%doc>
%
<%attr>
title        => 'HOST Tasks' 
</%attr>
%
%
%#######################################################################
%#
%# Args section
%#
%#######################################################################
<%args>
$action     => undef
$search     => undef
$user       => undef
$submit     => undef
$show_tasks => undef
$showheader => 1
$ipblock_id => undef
$ip         => undef
</%args>
%
%
%
%#######################################################################
%#
%# INIT section
%#
%#######################################################################
%
<%init>
my $DEBUG = 0;
print '%ARGS is  <pre>', Dumper(%ARGS), '</pre><br>' if $DEBUG;

$show_tasks = $show_tasks || $user->getAttribute("SHOW_TASKS");
if ( $show_tasks eq "" ) {
    $user->setAttribute($r, "SHOW_TASKS", "show");
    $show_tasks = "show";
}
*print_showtaskslink = $m->comp('SELF:.sub_print_showtaskslink'); 
my $hideheader = 'style="display:none"' if ( !$showheader );

my @list;

</%init>

<div id="sectiontools" <% $hideheader %>>
  <div class="container">
    <div class="containerheadleft">
        Tasks
    </div>
    <div class="containerheadright">
%       print_showtaskslink($show_tasks);
    </div>
    <div class="containerbody" id="tasks" style="display:<% ($show_tasks eq "show"?"block":"none") %>">
        <table><tr><td>
        <fieldset class="medium">
            <legend>Search</legend>
            <form action="hostinfo_tasks.html" method="POST">
                <p>
                <label for="Find">Host:</label>
                <input type="hidden" name="action" value="search">
                <input type="text" name="search" class="txt" value="<% $search %>"> 
                <input name="submit" value="Find" class="btn" type="submit">
                </p>
            </form>
        </fieldset>
        <fieldset class="medium">
            <legend>Add New Host</legend>
            <form action="hostinfo_tasks.html" method="POST">
% my (@field_headers, @cell_data) = ((),());
% $ui->add_to_fields(table=>'RR', edit=>1, fields=>['name', 'zone'],
%		     field_headers=>\@field_headers, cell_data=>\@cell_data,
%		     linkpages=>['view.html','view.html']);
% push (@field_headers, ("IP", ""));
% push (@cell_data, "<input type='text' name='ip' class='txt' value=''>");
% push (@cell_data, "<input name='submit' value='Add' class='btn' type='submit'>");
% my $newrr = $m->scomp('/generic/attribute_table.mhtml', field_headers=>\@field_headers, data=>\@cell_data,
%	   width=>"1", headercolwidth=>"10%", datacolwidth=>"90%");
% $newrr =~ s/type="text"/type="text" class="txt"/g;
% $newrr =~ s/type="button"/type="button" class="btn"/g;
% print $newrr;
                <input type="hidden" name="action" value="new">
            </form>
        </fieldset>
        </td></tr></table>
    </div> <!-- close containerbody -->
  </div> <!-- close container -->
</div> <!-- close sectiontools -->




<%perl>
#######################################################################################
# Search
#
#######################################################################################

if ( $action eq "search" && $submit ){
    # Remove trailing and leading spaces
    my %idx;
    if ( $search ){
	$search =~ s/^\s*(.*)\s*$/$1/g;
        @list = RR->search_like(name=>$search);
	
	# Display search results
	if ( @list ){
	    print '<div class="container">';
	    print '<div class="containerhead">';
	    print "Query <em>$search</em> returned: ".scalar(@list)." matches";
	    print "</div>";
	    print '<div class="containerbody">';
	    $m->comp('/generic/sortresults.mhtml', object=>\@list, page=>'view.html', withedit=>0);
	    print "</div>\n</div>";
	} else {
	    $m->comp('/generic/no_search_results.html', search=>$search);
        }
    } else {
	$m->comp('/generic/no_search_criteria.html');
    }

#######################################################################################
# Edit single IP
#
#######################################################################################

} elsif ( $action eq "edit" && $ipblock_id) {
    $m->comp('/management/host.html', ipblock=>$ipblock_id, edit=>1);


#######################################################################################
# New host
#
#######################################################################################

} elsif ( $action eq "new" ) {
    if (defined $ip && $ip ne "" && $submit) {
	$m->comp('/management/host.html', ipblock=>$ip, %ARGS);
    } elsif (defined $ARGS{RR__NEW__name} && $ARGS{RR__NEW__name} ne "" && $submit) {
	$m->comp('/management/host.html', %ARGS);
    } else {
	$m->comp('/management/host.html', submit=>0);
    }
#     my @rraddrs = RRADDR->search(ipblock=>$ipblock_id);
#     foreach my $rraddr (@rraddrs){
# 	$m->comp('/management/host.html', rrid=>$rraddr->rr, edit=>1);
#     }
}


</%perl>

