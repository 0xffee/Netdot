<%doc>
Interface for VLAN Groups
</%doc>
%
%
<%attr>
title   => 'VLANs' 
section => 'Management'
</%attr>
%
%
<%args>
$id                => undef
$search            => undef
$_action           => 'SHOW_GROUPS'
$name              => undef
$start             => undef
$end               => undef
$edit              => undef
</%args>
%
%
<%init>

my $DEBUG = 0;
my $o;
my @list;

print "<pre>", Dumper(%ARGS), "</pre><br>" if $DEBUG;

</%init>

<div id="sectiondetail">

%#######################################################################################
%# Search
%#
%#######################################################################################

% if ( defined $search ){
%    # Remove trailing and leading spaces
%    $search =~ s/^\s*(.*)\s*$/$1/g;

%    if ( $_action eq "SEARCH_VLAN" ){
%        my %idx;
%        map { push @list, $_; $idx{$_->id}++ }  Vlan->search_like(vid=>$search);
%        map { push @list, $_ && $idx{$_->id}++  unless exists $idx{$_->id} } Vlan->search_like(name=>$search);
%        map { push @list, $_ && $idx{$_->id}++  unless exists $idx{$_->id} } Vlan->search_like(description=>$search);
%       

%    }elsif ( $_action eq "SEARCH_VLANGROUP" ) {
%        my %idx;
%        map { push @list, $_; $idx{$_->id}++ }  VlanGroup->search_like(name=>$search);
%        map { push @list, $_ && $idx{$_->id}++  unless exists $idx{$_->id} } VlanGroup->search_like(description=>$search);

%    }
	 <div class="container">
           <div class="containerhead">
              Query <em><% $search %></em> returned: <% scalar(@list) %> matches
           </div>
           <div class="containerbody">
%          if ( @list ){
               <& /generic/sortresults.mhtml, object=>\@list, page=>'view.html', withedit=>0  &>
%          }else{
	       <form action="vlan.html" method="POST">
                 <p>
                 <label for="search"><% $_action %>:</label>
                 <input type="text" name="search" class="txt" value="<% $search %>"> 
                 <input name="submit" value="search" class="btn" type="submit">
                 <input type="hidden" name="_action" value="<% $_action %>">
                 </p>
               </form> 
%         }
          </div>
       </div>

%#######################################################################################
%# INSERT
%#
%#######################################################################################
%}elsif( $_action eq "INSERT" && !$o ){
    
<%perl>
    if ( $name && $start && $end ){
	eval {
	    VlanGroup->insert({name=>$name, start_vid=>$start, end_vid=>$end});
	};
	if ( my $e = $@ ){
	    $m->comp('/generic/error.mhtml', error=>$e);
	}
	$_action = 'SHOW_GROUPS';
    }else{
	$m->comp('/generic/error.mhtml', error=>"Missing required arguments: 'name', 'start', 'end'");
    }
</%perl>    
%}

%#######################################################################################
%# Show Groups
%#
%#######################################################################################
%if( $_action eq "SHOW_GROUPS" && !$o ){
    
%    @list = VlanGroup->retrieve_all;
    
      <div class="container">
          <div class="containerheadleft">VLAN Groups:</div>
	  <div class="containerheadright">
%	  if ( $edit ){
               &nbsp;
%	  }else{
	      <a href="vlan.html?$action=<% $_action %>&edit=1">[edit]</a>
%	  }
          </div>
          <div class="containerbody">
%             if ( @list ){
%	          if ( $edit ){
                      <& /generic/sortresults.mhtml, object => \@list, page=>'view.html', withedit=>1  &>
%                 }else{
                      <& /generic/sortresults.mhtml, object => \@list, page=>'view.html', withedit=>0  &>
%                 }
%             }else{
                  No VLAN Groups Defined
%             }
          </div>
      </div>
%}

</div> <!-- End sectiondetail -->
