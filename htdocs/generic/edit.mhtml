<%doc>

HTML code for edit.html component

</%doc>


<%args>
$ID         => undef
$TBL        => undef
$OBJ        => undef
$sid        => undef
$WIDTH      => 2
$session    => undef
%args       => undef
%state      => undef
$showheader
</%args>

<%init>
use URI::Escape;
my $DEBUG = 0;

foreach my $j ( keys %ARGS ) {
  if( $j eq "args" ) {
    %args = %{ $ARGS{$j} };
    next;
  }
  if( $j eq "state" ) {
    %state = %{ $ARGS{$j} };
    next;
  }
}

print "<pre>", Dumper(%args), "</pre>" if $DEBUG;

my $page;
if( $showheader ) {
    $page = "edit.html";
} else {
    $page = "insertentry.html";
}

my $select_id = $args{select_id};
my $selected  = $args{selected};

my $title = $TBL || "Edit";

</%init>

<%doc>

This block catches the case where we have confirmed a submission and now
want to go to the page to view it

</%doc>

% if( $args{cancel} && $TBL && $ID
%     && $args{table} eq $TBL
%     && ( ! defined( $session->{path} ) || length( $session->{path} ) < 1 ) ){
      <& view.html, table => $TBL, id => $ID &>
% } elsif( $args{confirm} eq "Confirm" && ( ! $TBL || $args{cancel} ) ) {
%    if ( $showheader ){
      <& view.html, table => $args{create}, id => $ID &>
%    }else{
%      my $obj = $args{create}->retrieve($ID);
%      my $lbl = $ui->getobjlabel($obj, ", ");


       <script language="javascript" type="text/javascript">  
 	  	<!--  
	  	// this code inserts an element into the select box in the  
 	  	// calling page form, and selects the new element if needed  
 	  	//  
 	  	function insertOption(id, text, value, sel) {  
 	  	  var select_box = opener.document.getElementById(id);  
 	  	  var elOptNew = document.createElement('option');  
 	  	  elOptNew.text = text;  
 	  	  elOptNew.value = value;  
 	  	  try {  
 	  	    select_box.add(elOptNew, null); // standards compliant; does not work in IE  
 	  	  }  
 	  	  catch(ex) {  
 	  	    select_box.add(elOptNew); // IE only  
 	  	  }  
 	  	  if (sel == 1){  
 	  	      select_box.selectedIndex = select_box.length-1;  
 	  	  }  
 	  	}  
 	  	 
        function addandclose() {
            insertOption('<% $select_id %>', '<% $lbl %>', '<% $ID %>', '<% $selected %>'); 
            window.close();
        }

 	  	//-->  
       </script>  

%    }
% ####################################################################
% } else {

<%doc>

The user has clicked on submit.  Present a page for user to confirm
the submission.

</%doc>

    <div id="sectiondetail">

%   if( $args{"submit"} eq "Submit" ) {
    <table width="100%" cellpadding="0" cellspacing="0" border="0" class="formtablebg">
      <tr class="rowtitle0" >
        <td align="CENTER"><strong><% $title %></strong></td>
      </tr>
      <tr><td>
      <p>Please confirm the following:
%     my %linksto = $ui->meta->get_links_to( $TBL );
%     my %tags = $ui->meta->get_column_tags( $TBL );
      <p><blockquote><strong><% $TBL %></strong><ul>
%     my %columns = $ui->meta->get_column_order($TBL);
%     foreach my $C ( keys %columns ) {
        <li>
% 	if ( exists($tags{$C}) ){
           <% $tags{$C} %> :
%	}else{
           <% $C %> :	   
%	}
%       if( ! exists( $session->{tables}{$TBL}{$C} ) ) {
          -
%       } else {
%         if( $linksto{$C} ) {
%           my %tables;
%           map { $tables{$_} = 1 } $ui->meta->get_tables;
%           if( ! exists( $tables{$linksto{$C}} ) ) {
              No such object <% $linksto{$C} %>
%           } elsif( $session->{tables}{$TBL}{$C} == 0 ) {
              -
%           } elsif( ! defined( $linksto{$C}->
%                    retrieve( int( $session->{tables}{$TBL}{$C} ) ) ) ) {
              -
%           } else {
%             my $o = $linksto{$C}->retrieve( $session->{tables}{$TBL}{$C} );
%             my $lbl = $ui->getobjlabel( $o, ", " );
              <% $lbl %>
%           }
%         } else {
            <% $session->{tables}{$TBL}{$C} %>
%         }
%       }
        </li>
%     }
      </td></tr>
      <tr class="rowtitle0" >
      <td align="CENTER">
      </ul></blockquote>
      <form name="netdotform" action="<% $page %>" method="POST">
      <input type="hidden" name="sid" value="<% $sid %>">
      <input type="hidden" name="create" value="<% $TBL %>">
      <input type="hidden" name="showheader" value="<% $showheader %>"> 
      <input type="hidden" name="select_id" value="<% $select_id %>">
      <input type="hidden" name="selected" value="<% $selected %>">
%     my $onload_action = uri_escape("addandclose()");
      <input type="hidden" name="onload" value="<% $onload_action %>">
%     if( $ID ) {
      <input type="hidden" name="id" value="<% $ID %>">
%     }
      <input name="confirm" value="Confirm" type="submit">
      <input name="cancel" value="Cancel" type="submit">
      </form>
      </td>
      </tr>
      </table>
%   ##############################################
<%doc>

We were called without any arguments.  Present a default listing of
available tables.

</%doc>
%   } elsif( ! $TBL ) {
      <p>
      <blockquote>
      <& table.mhtml, width => $WIDTH, link => "$page", title => "Please select an object to create:" &>
      </blockquote>
%   ##################### any validation checking. They are intended to pr#########################
%   } else {

<%doc>

Present a form for user to modify various values.

</%doc>

<div class="container">
    <div class="containerhead">
        <% $title %>
    </div>
    <div class="containerbody">
      <form name="netdotform" action="<% $page %>" method="POST">
      <input type="hidden" name="sid" value="<% $sid %>">
      <input type="hidden" name="showheader" value="<% $showheader %>"> 
      <input type="hidden" name="select_id" value="<% $select_id %>">
      <input type="hidden" name="selected" value="<% $selected %>">
%     if( $ID ) {
      <& form.mhtml, table => $TBL, id => $ID &>
%     } else {
%       if( $ID ) {
      <input type="hidden" name="id" value="<% $ID %>">
%       }
      <& form.mhtml, title => $title, table => $TBL, session => \%state &>
%     }
      <br>
      <input name="submit" value="Submit" type="submit">
      <input name="cancel" value="Cancel" type="submit">
      </form>
    </div>
</div>
%   } # if/else table
    <p>
    <!-- end edit -->
% }

% if ( $showheader ){
    </div>
% }
