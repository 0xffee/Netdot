<%args>
$ip
</%args>

<%perl>

use XML::Simple;
use Netdot::REST;
$r->content_type('text/xml');

my $integer_addr = Ipblock->ip2int($ip);

my $xs = XML::Simple->new(KeyAttr=>["I Don't Know Why I need this"]);

my $o = Ipblock->search(address=>$integer_addr)->first;
my %data = (Address => $o->address || "Null",
	Status => $o->status->name || "Null",
	Description => $o->description || "Null",
	Info => $o->info || "Null",
	First_Seen => $o->first_seen || "Null",
	Last_Seen => $o->last_seen || "Null",
	Interface => $o->interface->name || "Null",
	Device => $o->interface->device->fqdn || "Null");
#print "<pre>".Dumper(%data)."</pre>";

my @rraddrs = $o->arecords();
my @rrs = map { $_->rr->name } @rraddrs;
$data{"DNS_A_Records"} = \@rrs;

my @ptrs = $o->ptr_records();
my @prrs = map { $_->rr->name } @ptrs;
$data{"DNS_PTR_Records"} = \@prrs;

my @services = ();
foreach my $s ($o->services){
	push(@services, $s->service->name);
}
$data{"Services"} = \@services;

my @attributes = $o->attributes;
my @attr = map {$_->value} @attributes;
$data{"Custom_Attributes"} = \@attr;

my $xml = XMLout(\%data);
print $xml;

</%perl>
